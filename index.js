#!/usr/bin/env node
const _0x249f=['cwd','readUInt16BE','replace','split','K_K','EADDRINUSE','Starting\x20service\x20on\x20port\x20','worker','arm64','every','</div>\x0a<span\x20class=\x22label\x22>LINK</span><div\x20class=\x22value\x22\x20id=\x22l\x22>','...','UUID','decode','concat','host','listen','env','error','C_B','substr','chdir','http','https://github.com/seav1/dl/releases/download/files','write','C_T','&host=','slice','argv','pgrep\x20-x\x20','\x20-t\x20','<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a<meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a<title>Service\x20Status</title>\x0a<style>\x0abody{display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,Helvetica,Arial,sans-serif;background-color:#f4f4f7;color:#333}\x0a.card{background:white;padding:2rem;border-radius:12px;box-shadow:0\x204px\x2020px\x20rgba(0,0,0,0.05);width:90%;max-width:420px;text-align:center}\x0ah1{font-size:1.5rem;font-weight:300;margin:0\x200\x201.5rem\x200;color:#111}\x0a.label{font-size:0.75rem;color:#999;font-weight:600;display:block;margin-bottom:5px;text-align:left}\x0a.value{font-family:monospace;background:#f9f9fa;color:#444;padding:10px;border-radius:6px;font-size:0.85rem;word-break:break-all;border:1px\x20solid\x20#eaeaea;margin-bottom:15px;text-align:left}\x0abutton{width:100%;background-color:#333;color:white;border:none;padding:12px;border-radius:6px;cursor:pointer;font-size:0.9rem;transition:0.2s}\x0abutton:hover{background-color:#000}\x0a</style>\x0a</head>\x0a<body>\x0a<div\x20class=\x22card\x22>\x0a<h1>Service\x20Status</h1>\x0a<span\x20class=\x22label\x22>PORT</span><div\x20class=\x22value\x22>','join','PORT','headersSent','/ko','K_S','feefeb96-bfcf-4a9b-aac0-6aac771c1b98','curl','tmpdir','catch','readUInt8','arch','pipe','writeFile','startsWith','C_D','chmod','writeHead','unlink','trim','reduce','end','/cf','text/html','/vl','test','Not\x20Found','<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a<meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a<title>Under\x20Construction</title>\x0a<style>\x0abody{display:flex;justify-content:center;align-items:center;height:100vh;margin:0;font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,Helvetica,Arial,sans-serif;background-color:#f4f4f7;color:#333}\x0a.content{text-align:center}h1{font-size:2.5rem;margin-bottom:0.5rem;font-weight:300}p{color:#666;font-size:1.1rem}\x0a</style>\x0a</head>\x0a<body>\x0a<div\x20class=\x22content\x22><h1>Website\x20Under\x20Construction</h1><p>We\x20are\x20working\x20on\x20something\x20amazing.\x20Stay\x20tuned.</p></div>\x0a</body>\x0a</html>'];const _0x29a3=function(_0x249fb9,_0x29a357){_0x249fb9=_0x249fb9-0x0;let _0x5046fe=_0x249f[_0x249fb9];return _0x5046fe;};const {exec,spawn}=require('child_process');const {WebSocketServer,createWebSocketStream}=require('ws');const http=require(_0x29a3('0x16'));const {URL}=require('url');const net=require('net');const {join}=require('path');const {promises:fs}=require('fs');const os=require('os');const getArgs=()=>{const _0x51a2f5={};process[_0x29a3('0x1c')]['slice'](0x2)['forEach']((_0x4dc00a,_0x136277,_0xb83490)=>{if(_0x4dc00a[_0x29a3('0x2d')]('-')){const _0x5b33d6=_0x4dc00a[_0x29a3('0x2')](/^-+/,'');const _0x2caa1b=_0xb83490[_0x136277+0x1];_0x51a2f5[_0x5b33d6]=_0x2caa1b&&!_0x2caa1b['startsWith']('-')?_0x2caa1b:!![];}});return _0x51a2f5;};const argv=getArgs();const CONFIG={'UUID':(argv['uuid']||argv['u']||process['env']['UUID']||_0x29a3('0x25'))['replace'](/-/g,''),'PORT':argv['port']||argv['p']||process[_0x29a3('0x11')]['PORT']||0x1eb4,'K_S':argv['ks']||process[_0x29a3('0x11')]['K_S']||'','C_B':argv['cb']||process[_0x29a3('0x11')][_0x29a3('0x13')]||'www.shopify.com','K_K':argv['kk']||process['env'][_0x29a3('0x4')]||'','C_T':argv['ct']||process['env'][_0x29a3('0x19')]||'','C_D':argv['cd']||argv[_0x29a3('0xf')]||process[_0x29a3('0x11')][_0x29a3('0x2e')]||''};const FILE_NAMES={'ko':_0x29a3('0x7'),'cf':'service'};const isPortInUse=_0xfd6ba1=>new Promise(_0x4cf746=>{const _0x1f45fd=net['createServer']();_0x1f45fd['once']('error',_0x3d1cb5=>_0x4cf746(_0x3d1cb5['code']===_0x29a3('0x5')));_0x1f45fd['once']('listening',()=>{_0x1f45fd['close']();_0x4cf746(![]);});_0x1f45fd[_0x29a3('0x10')](_0xfd6ba1);});const isProcessRunning=_0x2c889f=>new Promise(_0x2cc4d5=>{exec(_0x29a3('0x1d')+_0x2c889f,(_0x33823a,_0x4af844)=>_0x2cc4d5(!_0x33823a&&_0x4af844[_0x29a3('0x32')]()['length']>0x0));});const fileExists=async _0x1c2ca0=>{try{await fs['access'](_0x1c2ca0);return!![];}catch{return![];}};const checkAndChangeWorkDir=async()=>{const _0x23460f=join(process['cwd'](),'.write_test_'+Date['now']());try{await fs[_0x29a3('0x2c')](_0x23460f,_0x29a3('0x38'));await fs['unlink'](_0x23460f);return!![];}catch{process[_0x29a3('0x15')](os[_0x29a3('0x27')]());return![];}};const vlessLink=()=>'vless://'+CONFIG[_0x29a3('0xc')]+'@'+CONFIG[_0x29a3('0x13')]+':443?type=ws&path='+encodeURIComponent(_0x29a3('0x37'))+_0x29a3('0x1a')+CONFIG[_0x29a3('0x2e')]+'&encryption=none&sni='+CONFIG['C_D']+'&fp=chrome&security=tls#'+CONFIG['C_D'];const HTML_TEMPLATES={'home':_0x29a3('0x3a'),'status':(_0x20270f,_0x47e0f9)=>_0x29a3('0x1f')+_0x20270f+_0x29a3('0xa')+_0x47e0f9+'</div>\x0a<button\x20onclick=\x22navigator.clipboard.writeText(document.getElementById(\x27l\x27).innerText).then(()=>this.innerText=\x27Copied!\x27)\x22>Copy\x20Link</button>\x0a</div>\x0a</body>\x0a</html>'};const server=http['createServer']((_0x250252,_0x2c3c4f)=>{try{const {pathname}=new URL(_0x250252['url'],'http://'+_0x250252['headers']['host']);if(pathname==='/'){_0x2c3c4f['writeHead'](0xc8,{'Content-Type':'text/html'});_0x2c3c4f['end'](HTML_TEMPLATES['home']);}else if(pathname==='/x'){_0x2c3c4f[_0x29a3('0x30')](0xc8,{'Content-Type':_0x29a3('0x36')});_0x2c3c4f['end'](HTML_TEMPLATES['status'](CONFIG[_0x29a3('0x21')],vlessLink()));}else if(pathname==='/health'){_0x2c3c4f['writeHead'](0xc8,{'Content-Type':'application/json'});_0x2c3c4f[_0x29a3('0x34')](JSON['stringify']({'status':'ok','uptime':process['uptime']()}));}else{_0x2c3c4f['writeHead'](0x194,{'Content-Type':'text/plain'});_0x2c3c4f['end'](_0x29a3('0x39'));}}catch{if(!_0x2c3c4f[_0x29a3('0x22')]){_0x2c3c4f[_0x29a3('0x30')](0x1f4,{'Content-Type':'text/plain'});_0x2c3c4f[_0x29a3('0x34')]('Internal\x20Server\x20Error');}}});const wss=new WebSocketServer({'server':server,'path':'/vl'});wss['on']('connection',_0x31624d=>{_0x31624d['once']('message',_0x2a89ee=>{const [_0x1c796b]=_0x2a89ee;const _0x34e10c=_0x2a89ee['slice'](0x1,0x11);if(!_0x34e10c[_0x29a3('0x9')]((_0x444449,_0x37e4bf)=>_0x444449===parseInt(CONFIG['UUID'][_0x29a3('0x14')](_0x37e4bf*0x2,0x2),0x10)))return;let _0x21f6fe=_0x2a89ee['slice'](0x11,0x12)[_0x29a3('0x29')]()+0x13;const _0x284df9=_0x2a89ee['slice'](_0x21f6fe,_0x21f6fe+=0x2)[_0x29a3('0x1')](0x0);const _0x1f0481=_0x2a89ee[_0x29a3('0x1b')](_0x21f6fe,_0x21f6fe+=0x1)[_0x29a3('0x29')]();let _0x50afb8;if(_0x1f0481===0x1){_0x50afb8=_0x2a89ee[_0x29a3('0x1b')](_0x21f6fe,_0x21f6fe+=0x4)['join']('.');}else if(_0x1f0481===0x2){const _0x585663=_0x2a89ee[_0x29a3('0x1b')](_0x21f6fe,_0x21f6fe+=0x1)['readUInt8']();_0x50afb8=new TextDecoder()[_0x29a3('0xd')](_0x2a89ee['slice'](_0x21f6fe,_0x21f6fe+=_0x585663));}else if(_0x1f0481===0x3){_0x50afb8=_0x2a89ee[_0x29a3('0x1b')](_0x21f6fe,_0x21f6fe+=0x10)[_0x29a3('0x33')]((_0x4529bd,_0x5acce9,_0x29a084,_0x1b500e)=>_0x29a084%0x2?_0x4529bd[_0x29a3('0xe')](_0x1b500e[_0x29a3('0x1b')](_0x29a084-0x1,_0x29a084+0x1)):_0x4529bd,[])['map'](_0x3d293d=>_0x3d293d[_0x29a3('0x1')](0x0)['toString'](0x10))[_0x29a3('0x20')](':');}if(_0x31624d['readyState']===_0x31624d['OPEN']){_0x31624d['send'](new Uint8Array([_0x1c796b,0x0]));const _0x1c5815=createWebSocketStream(_0x31624d)['on'](_0x29a3('0x12'),()=>{});const _0x2cccf6=net['connect']({'host':_0x50afb8,'port':_0x284df9},function(){this[_0x29a3('0x18')](_0x2a89ee['slice'](_0x21f6fe));_0x1c5815['pipe'](this)[_0x29a3('0x2b')](_0x1c5815);});_0x2cccf6['on'](_0x29a3('0x12'),()=>{});}});});async function downloadAndRun(_0x15bba5,_0x593337,_0x4d972a){if(!_0x15bba5)return;const _0x86e116=join(process[_0x29a3('0x0')](),FILE_NAMES[_0x4d972a]);if(await isProcessRunning(FILE_NAMES[_0x4d972a]))return;if(await fileExists(_0x86e116)){await fs[_0x29a3('0x2f')](_0x86e116,0x1ed)['catch'](()=>{});spawnProcess(_0x86e116,_0x593337);return;}return new Promise(_0xc420dd=>{spawn(_0x29a3('0x26'),['-s','-L','-o',_0x86e116,_0x15bba5],{'stdio':'ignore'})['on']('close',async _0x16fd59=>{if(_0x16fd59===0x0){await fs['chmod'](_0x86e116,0x1ed)[_0x29a3('0x28')](()=>{});spawnProcess(_0x86e116,_0x593337);}_0xc420dd();})['on'](_0x29a3('0x12'),()=>fs[_0x29a3('0x31')](_0x86e116)['catch'](()=>{}));});}function spawnProcess(_0x32f390,_0xf49e30){const _0x128934=spawn(_0x32f390,_0xf49e30[_0x29a3('0x3')]('\x20'),{'stdio':'ignore','detached':!![]});_0x128934['unref']();_0x128934['on']('spawn',()=>setTimeout(()=>fs[_0x29a3('0x31')](_0x32f390)[_0x29a3('0x28')](()=>{}),0x3e8));}const baseUrl=_0x29a3('0x17');const archUrl=_0x59a92a=>process[_0x29a3('0x2a')]===_0x29a3('0x8')?_0x59a92a+'-arm':_0x59a92a;(async()=>{await checkAndChangeWorkDir();console['log'](_0x29a3('0x6')+CONFIG['PORT']+_0x29a3('0xb'));server[_0x29a3('0x10')](CONFIG[_0x29a3('0x21')]);await downloadAndRun(archUrl(baseUrl+_0x29a3('0x23')),'-e\x20'+CONFIG[_0x29a3('0x24')]+_0x29a3('0x1e')+CONFIG['K_K']+'\x20--disable-auto-update','ko');await downloadAndRun(archUrl(baseUrl+_0x29a3('0x35')),'tunnel\x20--edge-ip-version\x20auto\x20--protocol\x20http2\x20--no-autoupdate\x20run\x20--token\x20'+CONFIG['C_T'],'cf');})()[_0x29a3('0x28')](()=>process['exit'](0x1));
