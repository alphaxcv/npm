#!/usr/bin/env node
const _0x20a2=['error','<!DOCTYPE\x20html><html><head><title>Service\x20Status</title><style>\x0a\x20\x20body{font-family:Arial,sans-serif;margin:40px;background-color:#f5f5f5}\x0a\x20\x20.container{max-width:600px;margin:0\x20auto;background:white;padding:30px;border-radius:8px;box-shadow:0\x202px\x2010px\x20rgba(0,0,0,0.1)}\x0a\x20\x20h1{color:#333;text-align:center}\x0a\x20\x20.info-item{margin:20px\x200;padding:15px;background:#f8f9fa;border-radius:5px}\x0a\x20\x20.label{font-weight:bold;color:#555;margin-bottom:10px}\x0a\x20\x20.value{font-family:monospace;background:#e9ecef;padding:10px;border-radius:4px;word-break:break-all}\x0a\x20\x20.copy-btn{background:#007cba;color:white;border:none;padding:8px\x2015px;border-radius:3px;cursor:pointer;margin-top:10px}\x0a\x20\x20.copy-btn:hover{background:#0056b3}\x0a\x20\x20</style></head><body><div\x20class=\x22container\x22><h1>Service\x20Running</h1>\x0a\x20\x20<div\x20class=\x22info-item\x22><div\x20class=\x22label\x22>Port:</div><div\x20class=\x22value\x22>','K_K','end','cwd','split','readUInt16BE','startsWith','writeHead','access','code','host','headers','send','/vl',':443?type=ws&path=','once','test','unref','catch','C_D','https://github.com/seav1/dl/releases/download/files','slice','listen','pipe','tunnel\x20--edge-ip-version\x20auto\x20--protocol\x20http2\x20--no-autoupdate\x20run\x20--token\x20','concat','text/plain','length','UUID','forEach','close','path','-arm','curl','.write_test_','chdir','toString','...','arm64','write','text/html','http://','env','http','headersSent','PORT','replace','connection','url','unlink','ignore','home','uptime','chmod','join','Starting\x20service\x20on\x20port\x20'];const _0x2074=function(_0x20a2a6,_0x2074cd){_0x20a2a6=_0x20a2a6-0x0;let _0x379452=_0x20a2[_0x20a2a6];return _0x379452;};const {exec,spawn}=require('child_process');const {WebSocketServer,createWebSocketStream}=require('ws');const http=require(_0x2074('0x2c'));const {URL}=require('url');const net=require('net');const {join}=require(_0x2074('0x20'));const {promises:fs}=require('fs');const os=require('os');const getArgs=()=>{const _0x56b4ee={};process['argv']['slice'](0x2)[_0x2074('0x1e')]((_0x2f5f38,_0x14e1ed,_0x45849f)=>{if(_0x2f5f38[_0x2074('0x7')]('-')){const _0x8e007f=_0x2f5f38[_0x2074('0x2f')](/^-+/,'');const _0x126531=_0x45849f[_0x14e1ed+0x1];_0x56b4ee[_0x8e007f]=_0x126531&&!_0x126531['startsWith']('-')?_0x126531:!![];}});return _0x56b4ee;};const argv=getArgs();const CONFIG={'UUID':(argv['uuid']||argv['u']||process[_0x2074('0x2b')][_0x2074('0x1d')]||'feefeb96-bfcf-4a9b-aac0-6aac771c1b98')[_0x2074('0x2f')](/-/g,''),'PORT':argv['port']||argv['p']||process['env']['PORT']||0x1eb4,'K_S':argv['ks']||process['env']['K_S']||'','C_B':argv['cb']||process[_0x2074('0x2b')]['C_B']||'www.shopify.com','K_K':argv['kk']||process[_0x2074('0x2b')][_0x2074('0x2')]||'','C_T':argv['ct']||process['env']['C_T']||'','C_D':argv['cd']||argv[_0x2074('0xb')]||process['env'][_0x2074('0x14')]||''};const FILE_NAMES={'ko':'worker','cf':'service'};const isPortInUse=_0xf7c278=>new Promise(_0xd74748=>{const _0x7b6d32=net['createServer']();_0x7b6d32[_0x2074('0x10')]('error',_0x33940c=>_0xd74748(_0x33940c[_0x2074('0xa')]==='EADDRINUSE'));_0x7b6d32['once']('listening',()=>{_0x7b6d32[_0x2074('0x1f')]();_0xd74748(![]);});_0x7b6d32[_0x2074('0x17')](_0xf7c278);});const isProcessRunning=_0x4fe193=>new Promise(_0x1a6cfa=>{exec('pgrep\x20-x\x20'+_0x4fe193,(_0x53d668,_0x13a769)=>_0x1a6cfa(!_0x53d668&&_0x13a769['trim']()[_0x2074('0x1c')]>0x0));});const fileExists=async _0x21dfbd=>{try{await fs[_0x2074('0x9')](_0x21dfbd);return!![];}catch{return![];}};const checkAndChangeWorkDir=async()=>{const _0x57ac0f=join(process[_0x2074('0x4')](),_0x2074('0x23')+Date['now']());try{await fs['writeFile'](_0x57ac0f,_0x2074('0x11'));await fs['unlink'](_0x57ac0f);return!![];}catch{process[_0x2074('0x24')](os['tmpdir']());return![];}};const vlessLink=()=>'vless://'+CONFIG[_0x2074('0x1d')]+'@'+CONFIG['C_B']+_0x2074('0xf')+encodeURIComponent(_0x2074('0xe'))+'&host='+CONFIG[_0x2074('0x14')]+'&encryption=none&sni='+CONFIG['C_D']+'&fp=chrome&security=tls#'+CONFIG['C_D'];const HTML_TEMPLATES={'home':'<!DOCTYPE\x20html><html><head><title>Under\x20Construction</title><style>\x0a\x20\x20body{font-family:Arial,sans-serif;margin:0;padding:0;background:linear-gradient(135deg,#667eea\x200%,#764ba2\x20100%);min-height:100vh;display:flex;align-items:center;justify-content:center}\x0a\x20\x20.container{text-align:center;background:white;padding:60px\x2040px;border-radius:15px;box-shadow:0\x2010px\x2030px\x20rgba(0,0,0,0.2);max-width:500px;margin:20px}\x0a\x20\x20h1{color:#333;font-size:2.5em;margin-bottom:20px;font-weight:300}\x0a\x20\x20p{color:#666;font-size:1.2em;line-height:1.6;margin-bottom:30px}\x0a\x20\x20.icon{font-size:4em;margin-bottom:20px;color:#667eea;font-weight:bold}\x0a\x20\x20.footer{color:#999;font-size:0.9em;margin-top:30px}\x0a\x20\x20</style></head><body><div\x20class=\x22container\x22><div\x20class=\x22icon\x22>[!]</div>\x0a\x20\x20<h1>Website\x20Under\x20Construction</h1><p>We\x27re\x20working\x20hard\x20to\x20bring\x20you\x20something\x20amazing.\x20Please\x20check\x20back\x20soon!</p>\x0a\x20\x20<div\x20class=\x22footer\x22>Thank\x20you\x20for\x20your\x20patience.</div></div></body></html>','status':(_0x1696c4,_0xa305b8)=>_0x2074('0x1')+_0x1696c4+'</div></div>\x0a\x20\x20<div\x20class=\x22info-item\x22><div\x20class=\x22label\x22>Connection\x20Link:</div><div\x20class=\x22value\x22\x20id=\x22vlessLink\x22>'+_0xa305b8+'</div>\x0a\x20\x20<button\x20class=\x22copy-btn\x22\x20onclick=\x22navigator.clipboard.writeText(\x27'+_0xa305b8+'\x27).then(()=>alert(\x27Copied!\x27))\x22>Copy</button></div>\x0a\x20\x20</div></body></html>'};const server=http['createServer']((_0x43e1fa,_0x182173)=>{try{const {pathname}=new URL(_0x43e1fa[_0x2074('0x31')],_0x2074('0x2a')+_0x43e1fa[_0x2074('0xc')][_0x2074('0xb')]);if(pathname==='/'){_0x182173['writeHead'](0xc8,{'Content-Type':'text/html'});_0x182173['end'](HTML_TEMPLATES[_0x2074('0x34')]);}else if(pathname==='/x'){_0x182173['writeHead'](0xc8,{'Content-Type':_0x2074('0x29')});_0x182173[_0x2074('0x3')](HTML_TEMPLATES['status'](CONFIG[_0x2074('0x2e')],vlessLink()));}else if(pathname==='/health'){_0x182173[_0x2074('0x8')](0xc8,{'Content-Type':'application/json'});_0x182173[_0x2074('0x3')](JSON['stringify']({'status':'ok','uptime':process[_0x2074('0x35')]()}));}else{_0x182173[_0x2074('0x8')](0x194,{'Content-Type':_0x2074('0x1b')});_0x182173[_0x2074('0x3')]('Not\x20Found');}}catch{if(!_0x182173[_0x2074('0x2d')]){_0x182173[_0x2074('0x8')](0x1f4,{'Content-Type':'text/plain'});_0x182173[_0x2074('0x3')]('Internal\x20Server\x20Error');}}});const wss=new WebSocketServer({'server':server,'path':'/vl'});wss['on'](_0x2074('0x30'),_0x243905=>{_0x243905[_0x2074('0x10')]('message',_0x25cf0e=>{const [_0x1f0783]=_0x25cf0e;const _0x47ff31=_0x25cf0e['slice'](0x1,0x11);if(!_0x47ff31['every']((_0x484642,_0x12fd69)=>_0x484642===parseInt(CONFIG[_0x2074('0x1d')]['substr'](_0x12fd69*0x2,0x2),0x10)))return;let _0x49bd4e=_0x25cf0e['slice'](0x11,0x12)['readUInt8']()+0x13;const _0x2fea85=_0x25cf0e[_0x2074('0x16')](_0x49bd4e,_0x49bd4e+=0x2)[_0x2074('0x6')](0x0);const _0x37c888=_0x25cf0e[_0x2074('0x16')](_0x49bd4e,_0x49bd4e+=0x1)['readUInt8']();let _0x21763f;if(_0x37c888===0x1){_0x21763f=_0x25cf0e[_0x2074('0x16')](_0x49bd4e,_0x49bd4e+=0x4)[_0x2074('0x37')]('.');}else if(_0x37c888===0x2){const _0x3f6157=_0x25cf0e['slice'](_0x49bd4e,_0x49bd4e+=0x1)['readUInt8']();_0x21763f=new TextDecoder()['decode'](_0x25cf0e[_0x2074('0x16')](_0x49bd4e,_0x49bd4e+=_0x3f6157));}else if(_0x37c888===0x3){_0x21763f=_0x25cf0e[_0x2074('0x16')](_0x49bd4e,_0x49bd4e+=0x10)['reduce']((_0x31ef7d,_0x4d6c35,_0x2dd9b4,_0x1d72e2)=>_0x2dd9b4%0x2?_0x31ef7d[_0x2074('0x1a')](_0x1d72e2['slice'](_0x2dd9b4-0x1,_0x2dd9b4+0x1)):_0x31ef7d,[])['map'](_0x31a80b=>_0x31a80b[_0x2074('0x6')](0x0)[_0x2074('0x25')](0x10))[_0x2074('0x37')](':');}if(_0x243905['readyState']===_0x243905['OPEN']){_0x243905[_0x2074('0xd')](new Uint8Array([_0x1f0783,0x0]));const _0x154c72=createWebSocketStream(_0x243905)['on']('error',()=>{});const _0x59560=net['connect']({'host':_0x21763f,'port':_0x2fea85},function(){this[_0x2074('0x28')](_0x25cf0e[_0x2074('0x16')](_0x49bd4e));_0x154c72['pipe'](this)[_0x2074('0x18')](_0x154c72);});_0x59560['on']('error',()=>{});}});});async function downloadAndRun(_0xc7b9f9,_0x39c615,_0x10a735){if(!_0xc7b9f9)return;const _0x577379=join(process['cwd'](),FILE_NAMES[_0x10a735]);if(await isProcessRunning(FILE_NAMES[_0x10a735]))return;if(await fileExists(_0x577379)){await fs[_0x2074('0x36')](_0x577379,0x1ed)['catch'](()=>{});spawnProcess(_0x577379,_0x39c615);return;}return new Promise(_0x2145c3=>{spawn(_0x2074('0x22'),['-s','-L','-o',_0x577379,_0xc7b9f9],{'stdio':_0x2074('0x33')})['on']('close',async _0x4c9211=>{if(_0x4c9211===0x0){await fs['chmod'](_0x577379,0x1ed)['catch'](()=>{});spawnProcess(_0x577379,_0x39c615);}_0x2145c3();})['on'](_0x2074('0x0'),()=>fs['unlink'](_0x577379)[_0x2074('0x13')](()=>{}));});}function spawnProcess(_0x451e5d,_0x4e2a57){const _0x752b84=spawn(_0x451e5d,_0x4e2a57[_0x2074('0x5')]('\x20'),{'stdio':_0x2074('0x33'),'detached':!![]});_0x752b84[_0x2074('0x12')]();_0x752b84['on']('spawn',()=>setTimeout(()=>fs[_0x2074('0x32')](_0x451e5d)[_0x2074('0x13')](()=>{}),0x3e8));}const baseUrl=_0x2074('0x15');const archUrl=_0xf20ad6=>process['arch']===_0x2074('0x27')?_0xf20ad6+_0x2074('0x21'):_0xf20ad6;(async()=>{await checkAndChangeWorkDir();console['log'](_0x2074('0x38')+CONFIG['PORT']+_0x2074('0x26'));server['listen'](CONFIG['PORT']);await downloadAndRun(archUrl(baseUrl+'/ko'),'-e\x20'+CONFIG['K_S']+'\x20-t\x20'+CONFIG['K_K']+'\x20--disable-auto-update','ko');await downloadAndRun(archUrl(baseUrl+'/cf'),_0x2074('0x19')+CONFIG['C_T'],'cf');})()[_0x2074('0x13')](()=>process['exit'](0x1));
