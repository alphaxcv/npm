#!/usr/bin/env node
const _0x2949=['exit','PORT','readUInt8','end','http','port','writeFile','/health','tmpdir','C_D','feefeb96-bfcf-4a9b-aac0-6aac771c1b98','argv','cwd','<!DOCTYPE\x20html><html><head><title>Service\x20Status</title><style>\x0a\x20\x20body{font-family:Arial,sans-serif;margin:40px;background-color:#f5f5f5}\x0a\x20\x20.container{max-width:600px;margin:0\x20auto;background:white;padding:30px;border-radius:8px;box-shadow:0\x202px\x2010px\x20rgba(0,0,0,0.1)}\x0a\x20\x20h1{color:#333;text-align:center}\x0a\x20\x20.info-item{margin:20px\x200;padding:15px;background:#f8f9fa;border-radius:5px}\x0a\x20\x20.label{font-weight:bold;color:#555;margin-bottom:10px}\x0a\x20\x20.value{font-family:monospace;background:#e9ecef;padding:10px;border-radius:4px;word-break:break-all}\x0a\x20\x20.copy-btn{background:#007cba;color:white;border:none;padding:8px\x2015px;border-radius:3px;cursor:pointer;margin-top:10px}\x0a\x20\x20.copy-btn:hover{background:#0056b3}\x0a\x20\x20</style></head><body><div\x20class=\x22container\x22><h1>Service\x20Running</h1>\x0a\x20\x20<div\x20class=\x22info-item\x22><div\x20class=\x22label\x22>Port:</div><div\x20class=\x22value\x22>','text/html','readUInt16BE','map','env','listen','unref','error','writeHead','headers','</div>\x0a\x20\x20<button\x20class=\x22copy-btn\x22\x20onclick=\x22navigator.clipboard.writeText(\x27','/ko','Starting\x20service\x20on\x20port\x20','K_S','text/plain','close','pgrep\x20-x\x20','trim','Port\x20','-arm','UUID','C_T','createServer','host','unlink','listening','replace','OPEN','\x20is\x20already\x20in\x20use.','headersSent','uuid','startsWith','C_B','slice','log','arch','once','url','uptime','tunnel\x20--edge-ip-version\x20auto\x20--protocol\x20http2\x20--no-autoupdate\x20run\x20--token\x20','service','application/json','EADDRINUSE','&encryption=none&sni=','decode','ignore','connect','-e\x20','catch','connection'];const _0x4668=function(_0x294946,_0x46687a){_0x294946=_0x294946-0x0;let _0x49abbb=_0x2949[_0x294946];return _0x49abbb;};const {exec,spawn}=require('child_process');const {WebSocketServer,createWebSocketStream}=require('ws');const http=require(_0x4668('0x4'));const {URL}=require(_0x4668('0x32'));const net=require('net');const {join}=require('path');const {promises:fs}=require('fs');const os=require('os');const getArgs=()=>{const _0x52bb0c={};process[_0x4668('0xb')]['slice'](0x2)['forEach']((_0x309194,_0x12b8d1,_0xdd9002)=>{if(_0x309194[_0x4668('0x2c')]('-')){const _0x5382a4=_0x309194[_0x4668('0x27')](/^-+/,'');const _0x123461=_0xdd9002[_0x12b8d1+0x1];_0x52bb0c[_0x5382a4]=_0x123461&&!_0x123461['startsWith']('-')?_0x123461:!![];}});return _0x52bb0c;};const argv=getArgs();const CONFIG={'UUID':(argv[_0x4668('0x2b')]||argv['u']||process[_0x4668('0x11')][_0x4668('0x21')]||_0x4668('0xa'))['replace'](/-/g,''),'PORT':argv[_0x4668('0x5')]||argv['p']||process['env'][_0x4668('0x1')]||0x1eb4,'K_S':argv['ks']||process['env']['K_S']||'','C_B':argv['cb']||process[_0x4668('0x11')]['C_B']||'www.shopify.com','K_K':argv['kk']||process['env']['K_K']||'','C_T':argv['ct']||process['env']['C_T']||'','C_D':argv['cd']||argv[_0x4668('0x24')]||process[_0x4668('0x11')][_0x4668('0x9')]||''};const FILE_NAMES={'ko':'worker','cf':_0x4668('0x35')};const isPortInUse=_0x41dd51=>new Promise(_0x5e4b98=>{const _0x193af2=net[_0x4668('0x23')]();_0x193af2[_0x4668('0x31')]('error',_0x715d30=>_0x5e4b98(_0x715d30['code']===_0x4668('0x37')));_0x193af2['once'](_0x4668('0x26'),()=>{_0x193af2[_0x4668('0x1c')]();_0x5e4b98(![]);});_0x193af2[_0x4668('0x12')](_0x41dd51);});const isProcessRunning=_0x29a1d2=>new Promise(_0x4e00b3=>{exec(_0x4668('0x1d')+_0x29a1d2,(_0x44a2e7,_0x268a05)=>_0x4e00b3(!_0x44a2e7&&_0x268a05[_0x4668('0x1e')]()['length']>0x0));});const fileExists=async _0x572f7a=>{try{await fs['access'](_0x572f7a);return!![];}catch{return![];}};const checkAndChangeWorkDir=async()=>{const _0x866046=join(process[_0x4668('0xc')](),'.write_test_'+Date['now']());try{await fs[_0x4668('0x6')](_0x866046,'test');await fs['unlink'](_0x866046);return!![];}catch{process['chdir'](os[_0x4668('0x8')]());return![];}};const vlessLink=()=>'vless://'+CONFIG['UUID']+'@'+CONFIG[_0x4668('0x2d')]+':443?type=ws&path='+encodeURIComponent('/vl')+'&host='+CONFIG[_0x4668('0x9')]+_0x4668('0x38')+CONFIG['C_D']+'&fp=chrome&security=tls#'+CONFIG['C_D'];const HTML_TEMPLATES={'home':'<!DOCTYPE\x20html><html><head><title>Under\x20Construction</title><style>\x0a\x20\x20body{font-family:Arial,sans-serif;margin:0;padding:0;background:linear-gradient(135deg,#667eea\x200%,#764ba2\x20100%);min-height:100vh;display:flex;align-items:center;justify-content:center}\x0a\x20\x20.container{text-align:center;background:white;padding:60px\x2040px;border-radius:15px;box-shadow:0\x2010px\x2030px\x20rgba(0,0,0,0.2);max-width:500px;margin:20px}\x0a\x20\x20h1{color:#333;font-size:2.5em;margin-bottom:20px;font-weight:300}\x0a\x20\x20p{color:#666;font-size:1.2em;line-height:1.6;margin-bottom:30px}\x0a\x20\x20.icon{font-size:4em;margin-bottom:20px;color:#667eea;font-weight:bold}\x0a\x20\x20.footer{color:#999;font-size:0.9em;margin-top:30px}\x0a\x20\x20</style></head><body><div\x20class=\x22container\x22><div\x20class=\x22icon\x22>[!]</div>\x0a\x20\x20<h1>Website\x20Under\x20Construction</h1><p>We\x27re\x20working\x20hard\x20to\x20bring\x20you\x20something\x20amazing.\x20Please\x20check\x20back\x20soon!</p>\x0a\x20\x20<div\x20class=\x22footer\x22>Thank\x20you\x20for\x20your\x20patience.</div></div></body></html>','status':(_0x4643d1,_0x5ccce1)=>_0x4668('0xd')+_0x4643d1+'</div></div>\x0a\x20\x20<div\x20class=\x22info-item\x22><div\x20class=\x22label\x22>Connection\x20Link:</div><div\x20class=\x22value\x22\x20id=\x22vlessLink\x22>'+_0x5ccce1+_0x4668('0x17')+_0x5ccce1+'\x27).then(()=>alert(\x27Copied!\x27))\x22>Copy</button></div>\x0a\x20\x20</div></body></html>'};const server=http[_0x4668('0x23')]((_0x4dd98a,_0x21e42c)=>{try{const {pathname}=new URL(_0x4dd98a[_0x4668('0x32')],'http://'+_0x4dd98a[_0x4668('0x16')][_0x4668('0x24')]);if(pathname==='/'){_0x21e42c[_0x4668('0x15')](0xc8,{'Content-Type':_0x4668('0xe')});_0x21e42c['end'](HTML_TEMPLATES['home']);}else if(pathname==='/x'){_0x21e42c[_0x4668('0x15')](0xc8,{'Content-Type':_0x4668('0xe')});_0x21e42c['end'](HTML_TEMPLATES['status'](CONFIG[_0x4668('0x1')],vlessLink()));}else if(pathname===_0x4668('0x7')){_0x21e42c['writeHead'](0xc8,{'Content-Type':_0x4668('0x36')});_0x21e42c['end'](JSON['stringify']({'status':'ok','uptime':process[_0x4668('0x33')]()}));}else{_0x21e42c[_0x4668('0x15')](0x194,{'Content-Type':_0x4668('0x1b')});_0x21e42c[_0x4668('0x3')]('Not\x20Found');}}catch{if(!_0x21e42c[_0x4668('0x2a')]){_0x21e42c['writeHead'](0x1f4,{'Content-Type':_0x4668('0x1b')});_0x21e42c['end']('Internal\x20Server\x20Error');}}});const wss=new WebSocketServer({'server':server,'path':'/vl'});wss['on'](_0x4668('0x3e'),_0xdaa29e=>{_0xdaa29e[_0x4668('0x31')]('message',_0x374e0d=>{const [_0x323956]=_0x374e0d;const _0x1991b8=_0x374e0d['slice'](0x1,0x11);if(!_0x1991b8['every']((_0x5c4e25,_0x2d4bfe)=>_0x5c4e25===parseInt(CONFIG[_0x4668('0x21')]['substr'](_0x2d4bfe*0x2,0x2),0x10)))return;let _0x393c4b=_0x374e0d['slice'](0x11,0x12)[_0x4668('0x2')]()+0x13;const _0x4abe7b=_0x374e0d['slice'](_0x393c4b,_0x393c4b+=0x2)[_0x4668('0xf')](0x0);const _0x132a05=_0x374e0d[_0x4668('0x2e')](_0x393c4b,_0x393c4b+=0x1)[_0x4668('0x2')]();let _0x48e02f;if(_0x132a05===0x1){_0x48e02f=_0x374e0d[_0x4668('0x2e')](_0x393c4b,_0x393c4b+=0x4)['join']('.');}else if(_0x132a05===0x2){const _0x53cb46=_0x374e0d[_0x4668('0x2e')](_0x393c4b,_0x393c4b+=0x1)['readUInt8']();_0x48e02f=new TextDecoder()[_0x4668('0x39')](_0x374e0d[_0x4668('0x2e')](_0x393c4b,_0x393c4b+=_0x53cb46));}else if(_0x132a05===0x3){_0x48e02f=_0x374e0d[_0x4668('0x2e')](_0x393c4b,_0x393c4b+=0x10)['reduce']((_0x346e67,_0x192571,_0x34bee4,_0x14defd)=>_0x34bee4%0x2?_0x346e67['concat'](_0x14defd[_0x4668('0x2e')](_0x34bee4-0x1,_0x34bee4+0x1)):_0x346e67,[])[_0x4668('0x10')](_0x257d76=>_0x257d76['readUInt16BE'](0x0)['toString'](0x10))['join'](':');}if(_0xdaa29e['readyState']===_0xdaa29e[_0x4668('0x28')]){_0xdaa29e['send'](new Uint8Array([_0x323956,0x0]));const _0x499f47=createWebSocketStream(_0xdaa29e)['on'](_0x4668('0x14'),()=>{});const _0x4f9dcb=net[_0x4668('0x3b')]({'host':_0x48e02f,'port':_0x4abe7b},function(){this['write'](_0x374e0d['slice'](_0x393c4b));_0x499f47['pipe'](this)['pipe'](_0x499f47);});_0x4f9dcb['on'](_0x4668('0x14'),()=>{});}});});async function downloadAndRun(_0x8339a0,_0x49b37c,_0x40e8f1){if(!_0x8339a0)return;const _0x13c7ab=join(process[_0x4668('0xc')](),FILE_NAMES[_0x40e8f1]);if(await isProcessRunning(FILE_NAMES[_0x40e8f1]))return;if(await fileExists(_0x13c7ab)){await fs['chmod'](_0x13c7ab,0x1ed)['catch'](()=>{});spawnProcess(_0x13c7ab,_0x49b37c);return;}return new Promise(_0x5ee739=>{spawn('curl',['-s','-L','-o',_0x13c7ab,_0x8339a0],{'stdio':_0x4668('0x3a')})['on'](_0x4668('0x1c'),async _0x337672=>{if(_0x337672===0x0){await fs['chmod'](_0x13c7ab,0x1ed)['catch'](()=>{});spawnProcess(_0x13c7ab,_0x49b37c);}_0x5ee739();})['on'](_0x4668('0x14'),()=>fs[_0x4668('0x25')](_0x13c7ab)[_0x4668('0x3d')](()=>{}));});}function spawnProcess(_0xbfff78,_0x50c488){const _0x81da1c=spawn(_0xbfff78,_0x50c488['split']('\x20'),{'stdio':_0x4668('0x3a'),'detached':!![]});_0x81da1c[_0x4668('0x13')]();_0x81da1c['on']('spawn',()=>setTimeout(()=>fs['unlink'](_0xbfff78)['catch'](()=>{}),0x3e8));}const baseUrl='https://github.com/seav1/dl/releases/download/files';const archUrl=_0x40a87e=>process[_0x4668('0x30')]==='arm64'?_0x40a87e+_0x4668('0x20'):_0x40a87e;(async()=>{await checkAndChangeWorkDir();console[_0x4668('0x2f')](_0x4668('0x19')+CONFIG['PORT']+'...');if(CONFIG[_0x4668('0x21')])console['log']('UUID:\x20'+CONFIG[_0x4668('0x21')]);if(await isPortInUse(CONFIG['PORT'])){console[_0x4668('0x14')](_0x4668('0x1f')+CONFIG['PORT']+_0x4668('0x29'));process['exit'](0x1);}server[_0x4668('0x12')](CONFIG[_0x4668('0x1')]);await downloadAndRun(archUrl(baseUrl+_0x4668('0x18')),_0x4668('0x3c')+CONFIG[_0x4668('0x1a')]+'\x20-t\x20'+CONFIG['K_K']+'\x20--disable-auto-update','ko');await downloadAndRun(archUrl(baseUrl+'/cf'),_0x4668('0x34')+CONFIG[_0x4668('0x22')],'cf');})()[_0x4668('0x3d')](()=>process[_0x4668('0x0')](0x1));
